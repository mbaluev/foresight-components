var Dashboard=function(a){var t=this._dashboard={};return t.const={CONTENT_LOADING:'<span class="spinner"></span>',CONTENT_NODATA:"Нет данных",CONTENT_ERROR:"Ошибка загрузки",BORDER_COLOR_DARK_BLUE:"#0070ba",BORDER_COLOR_BLUE:"#5a97f2",BORDER_COLOR_LIGHT_BLUE:"#2fb4e9",BORDER_COLOR_DEFAULT:"#ccc",BORDER_COLOR_DARK_GREY:"#777",BORDER_COLOR_PURPLE:"#8e6bf5",BORDER_COLOR_RED:"#ff5940",BORDER_COLOR_GREEN:"#13a89e",BORDER_COLOR_NONE:"transparent",CONTENT_TYPE_TEXT:"text",CONTENT_TYPE_HTML:"html",CONTENT_TYPE_COUNT:"count"},t.data={id:Date.now(),title:null,name:null,single:!1,margin:!0,editable:!0,admin:!0,tumblerContainerSelector:null,pageid:"",items:[],lib:{foresight:{library:[],loader:null},dbm:{library:[],loader:null}},grid:null,add:function(a){},save:function(a,t,e){},load:function(a){},account:{id:-1,list:[],saved:[]},headerExtraControlsRenderer:null,params:null,type:"page",modal:null,modal_dbm:null,collapsed_widget_height:1,headerClass:null},t.data=$.extend(t.data,a),t.data._el={target:$("#"+t.data.containerid),targetTumbler:null,loader:$('<span class="spinner spinner_align_center"></span>')},t.render_card=function(){$("body").tooltip("clear"),t.data._el.tumbler&&t.data._el.tumbler.remove(),$.extend(t.data._el,{grid:$('<div class="widget-grid grid-stack" data-gs-animate="true"></div>'),card:$('<div class="card"></div>'),card__header:$(['<div class="card__header'+(t.data.headerClass?" "+t.data.headerClass:"")+'">','<div class="card__header-row card__header-row_wrap">','<div class="card__header-column" id="title"></div>','<div class="card__header-column card__header-column_start" id="actions"></div>',"</div>","</div>"].join("")),card__header_row_name:$(['<div class="card__header-row">','<div class="card__header-column" id="name"></div>',"</div>"].join("")),card__main:$(['<div class="card__main">','<div class="card__middle">','<div class="card__middle-scroll" id="card__middle-scroll">',"</div>","</div>","</div>"].join("")),card__caption:$(['<label class="card__caption">','<span class="card__caption-text"></span>',"</label>"].join("")),card__name:$(['<label class="card__name">','<span class="card__name-text"></span>',"</label>"].join("")),tumbler:$(['<span class="header__column-item tumbler" id="tumbler_edit-page">','<span class="tumbler__box">','<div class="tumbler__sticker tumbler__sticker_position_left">','<div class="tumbler__sticker-label">Вкл</div>',"</div>",'<div class="tumbler__sticker tumbler__sticker_position_right">','<div class="tumbler__sticker-label">Выкл</div>',"</div>",'<button class="button" type="button" data-fc="button">','<span class="icon icon_svg_edit"></span>','<span class="button__anim"></span>',"</button>","</span>",'<input class="tumbler__input" type="checkbox" name="_tumbler" hidden/>',"</span>"].join("")).tumbler(),select_load:$('<select data-fc="select" data-width="200" data-autoclose="true" data-mode="radio" data-hidden="true" style="display:none;"></select>'),button_add:$(['<button class="button button_hidden" type="button" data-hidden="true" id="button_add-widget">','<span class="icon icon_svg_plus"></span>',"</button>"].join("")).button(),button_group_save:$('<span class="button-group header__column-item"></span>'),button_save:$(['<button class="button button_hidden" type="button" data-hidden="true" id="button_save-grid">','<span class="icon icon_svg_save"></span>',t.data.admin?"":'<span class="button__text mobile mobile_hide">Сохранить</span>',"</button>"].join("")).button(),button_more:$(['<button class="button button_hidden" type="button" data-hidden="true" id="button_save-arrow">','<span class="icon icon_animate icon_svg_down"></span>',"</button>"].join("")).button(),input:$(['<span class="input input__has-clear">','<span class="input__box">','<span class="alertbox">','<span class="icon icon_svg_search"></span>',"</span>",'<input type="text" class="input__control">','<button class="button" type="button">','<span class="icon icon_svg_close"></span>',"</button>","</span>","</span>"].join("")),popup_save:$('<div class="popup" data-fc="popup"></div>'),popup__input:$('<div class="popup__input"></div>'),popup__scroll:$('<div class="popup__scroll"></div>'),popup__list:$('<ul class="popup__list"></ul>'),popup__list_items:[]}),t.data._el.target.empty(),t.data._el.target.append(t.data._el.card),t.render_card_header(),t.render_card_main()},t.render_card_header=function(){var a=!1;"page"==t.data.type&&(t.data.title?(t.render_page_title(),a=!0):t.remove_page_title()),"card"==t.data.type&&(t.data.title?(t.render_card_title(),a=!0,t.data.name?(t.render_card_header_row(),t.render_card_name()):t.remove_card_name()):t.data.name?(t.rename_card_title(),t.render_card_name(),a=!0):(t.remove_card_title(),t.remove_card_name())),t.data.editable&&(t.data.admin||!t.data.admin&&!t.data.single)&&(t.render_tumbler(),t.render_buttons(),t.data.tumblerContainerSelector||(a=!0)),"function"==typeof t.data.headerExtraControlsRenderer&&(t.data._el.card__header.find("#actions").append(t.data.headerExtraControlsRenderer()),a=!0),a&&t.data._el.card.append(t.data._el.card__header)},t.render_card_main=function(){t.data._el.card__main.find("#card__middle-scroll").append(t.data._el.grid),t.data._el.card.append(t.data._el.card__main)},t.render_page_title=function(){t.set_title(t.data.title),t.data._el.card__header.find("#title").append(t.data._el.card__name)},t.remove_page_title=function(){t.data._el.card__header.find("#title").remove()},t.render_card_header_row=function(){t.data._el.card__header.append(t.data._el.card__header_row_name)},t.render_card_title=function(){t.set_title(t.data.title),t.data._el.card__header.find("#title").append(t.data._el.card__caption)},t.rename_card_title=function(){t.data._el.card__header.find("#title").attr("id","name")},t.remove_card_title=function(){t.data._el.card__header.find("#title").remove()},t.render_card_name=function(){t.set_name(t.data.name),t.data._el.card__header.find("#name").append(t.data._el.card__name)},t.remove_card_name=function(){t.data._el.card__header.find("#name").remove()},t.render_tumbler=function(){t.data._el.tumbler.on("on.fc.tumbler",function(){t.loader_add(),setTimeout(function(){t.data._el.button_group_save.show(),t.data._el.select_load.data("_widget")||t.data._el.select_load.select(),t.data._el.select_load.select("show"),t.data._el.button_save.button("show"),t.data._el.button_more.button("show"),t.data._el.button_add.button("show"),t.data.grid.widget_grid("edit_mode"),t.data.single&&t.data.grid.widget_grid("disable"),t.loader_remove()},100)}).on("off.fc.tumbler",function(){t.loader_add(),setTimeout(function(){t.data._el.button_group_save.hide(),t.data._el.select_load.data("_widget")&&t.data._el.select_load.select("hide"),t.data._el.button_save.button("hide"),t.data._el.button_more.button("hide"),t.data._el.button_add.button("hide"),t.data.grid.widget_grid("view_mode"),t.loader_remove()},100)}),t.data.tumblerContainerSelector?t.data._el.targetTumbler=$(t.data.tumblerContainerSelector):t.data._el.targetTumbler=t.data._el.card__header.find("#actions"),t.data._el.targetTumbler.prepend(t.data._el.tumbler)},t.render_buttons=function(){t.data._el.button_group_save.hide(),t.render_button_group_save(),t.data.admin&&(t.render_button_add(),t.render_select_load())},t.render_button_add=function(a){t.data._el.button_add.on("click",function(){var a={x:0,y:0,width:2,height:4,settings:{name:t.data.single?t.data.pageid:"Новый виджет",collapsed:!1}};t.data.grid.widget_grid("add_widget",a,function(a){"function"==typeof t.data.add&&t.data.add(a)}),t.data.single&&t.data._el.button_add.button("unhover").remove()}),t.data.single&&a&&t.data._el.button_add.button({hidden:!1}),t.data._el.targetTumbler.prepend(t.data._el.button_add)},t.render_button_group_save=function(){t.data._el.button_save.on("click",function(){t.data.grid.widget_grid("save",function(a){"function"==typeof t.data.save&&t.data.save(a,t.data.account.id),t.data._el.tumbler.tumbler("uncheck")})}),t.data._el.button_group_save.append(t.data._el.button_save),t.data.admin&&(t.render_popup_save(),t.data._el.button_group_save.append(t.data._el.button_more,t.data._el.popup_save)),t.data._el.targetTumbler.prepend(t.data._el.button_group_save)},t.render_popup_save=function(){t.data.account.list.unshift({value:-1,text:"Общий"}),t.data.account.list.map(function(a){var e=$(['<li class="popup__list-item',a.selected?" popup__list-item_checked":"",(a.disabled?" popup__list-item_disabled":"")+'">','<button class="popup__link">',a.icon?'<span class="icon '+a.icon+'"></span>':"",'<span class="popup__text">'+a.text+"</span>","</button>","</li>"].join(""));t.data._el.popup__list_items.push(e),e.data(a)}),t.data._el.popup_save.append(t.data._el.popup__input.append(t.data._el.input.input()),t.data._el.popup__scroll.append(t.data._el.popup__list.append(t.data._el.popup__list_items))),t.bind_popup_save(),t.bind_popup_save_input()},t.render_select_load=function(){0==t.data.account.saved.filter(function(a){return-1==a.value}).length&&t.data.account.saved.unshift({value:-1,text:"Общий"}),t.data.account.saved&&t.data.account.saved.map(function(a){a.selected=t.data.account.id==a.value,t.data._el.select_load.append($('<option value="'+a.value+'" '+(a.selected?'selected="selected"':"")+">"+a.text+"</option>"))}),t.data._el.select_load.on("change",function(){var a=$(this).select("value");a&&(t.data.account.id=a,"function"==typeof t.data.load&&t.data.load(t.data.account.id))}),t.data._el.targetTumbler.prepend(t.data._el.select_load)},t.update_select_load=function(a){t.data.admin&&(0==t.data.account.saved.filter(function(a){return t.data.account.id==a.value}).length&&t.data.account.saved.push(a),t.data.account.saved.map(function(a){a.selected=t.data.account.id==a.value}),t.data._el.select_load.data("_widget")&&t.data._el.select_load.select("update",t.data.account.saved))},t.bind_popup_save=function(){t.data._el.popup__list_items.forEach(function(a){a.on("click",function(){t.data.grid.widget_grid("save",function(e){var n=a.data();"function"==typeof t.data.save&&(t.data.account.id=n.value,t.data.save(e,t.data.account.id,n)),t.data._el.tumbler.tumbler("uncheck")}),t.data._el.popup_save.popup("hide")})})},t.bind_popup_save_input=function(){t.data._el.input.find(".input__control").on("keyup",function(){var a=t.data._el.input.input("value");t.data._el.popup__list_items.forEach(function(t){t.data().text.toLowerCase().includes(a.toLowerCase())?t.removeClass("popup__list-item_hidden"):t.addClass("popup__list-item_hidden")})})},t.render_single=function(){t.data.single&&t.data.items.length>0&&(t.data.items.splice(1,t.data.items.length-1),t.data._el.button_add.remove())},t.render_grid=function(){var a=[{id:"button_settings",icon:"icon_svg_settings",mode:"edit",click:function(a,e){t.settings(a,e)}}];t.data.admin&&a.push({id:"button_remove",icon:"icon_svg_trash",mode:"edit",click:function(a,e){t.data.grid.widget_grid("remove_widget",e.id),t.data.single&&t.render_button_add(!0)}}),t.data.grid=t.data._el.grid.widget_grid({single:t.data.single,margin:t.data.margin,pageid:t.data.pageid,items:t.data.items,lib:t.data.lib,params:t.data.params,widget_buttons:a,collapsed_widget_height:t.data.collapsed_widget_height})},t.update_grid=function(a){t.data.grid.widget_grid("load_items",a)},t.store_to_window=function(){void 0===window.dashboards&&(window.dashboards=[]),window.dashboards[t.data.id]=t},t.set_title=function(a){t.data.title=a,"page"==t.data.type&&t.data._el.card__name.find(".card__name-text").html(t.data.title),"card"==t.data.type&&t.data._el.card__caption.find(".card__caption-text").html(t.data.title)},t.set_name=function(a){t.data.name=a,"card"==t.data.type&&t.data._el.card__name.find(".card__name-text").html(t.data.name)},t.settings=function(a,e){var n={buttons:[{name:"reload",action:"reload",icon:"icon_svg_refresh"},{name:"save",action:"save",icon:"icon_svg_save_red"},{name:"destroy",action:"destroy",icon:"icon_svg_close"}],header:{caption:t.data.single?"Настройки страницы":"Настройки виджета",name:e.name},content:{tabs:[]},data:e,size:"sm",position:"top center",draggable:!0};t.data.admin?t.data.single?t.settings_render_source_tab(e,n.content.tabs,!0,a):(t.settings_render_general_tab(e,n.content.tabs,!0,a),t.settings_render_source_tab(e,n.content.tabs,!1,a)):t.data.single||t.settings_render_general_tab(e,n.content.tabs,!0,a),t.data.modal=$('<span class="modal__"></span>').appendTo("body").modal__(n).on("reload.fc.modal",function(){t.settings_apply(a,e,!0)}).on("save.fc.modal",function(){t.settings_apply(a,e,!1),$(this).modal__("destroy")})},t.settings_render_general_tab=function(a,e,n,d){e.push({id:"general",name:"Основные",active:n,content:$(['<div class="control"><div class="control__caption control__caption_size_s"><div class="control__text">Скрывать</div></div><div class="control__container"><label class="checkbox" data-fc="checkbox" data-field="collapsed"'+(a.collapsed?'data-checked="true"':"")+'><input class="checkbox__input" type="checkbox" name="collapsed"/><label class="checkbox__label"></label></label></div></div><div class="control"><div class="control__caption control__caption_size_s"><div class="control__text">Заголовок</div></div><div class="control__container"><span class="input input__has-clear" data-fc="input" data-field="name"><span class="input__box"><input type="text" class="input__control" value="'+a.name+'"><button class="button" type="button" data-fc="button"><span class="icon icon_svg_close"></span></button></span></span></div></div><div class="control"><div class="control__caption control__caption_size_s"><div class="control__text">Цвет</div></div><div class="control__container"><select class="select" name="color" data-fc="select" data-field="color"><option value="'+t.const.BORDER_COLOR_DEFAULT+'" '+(a.color==t.const.BORDER_COLOR_DEFAULT?"selected":"")+'>Серый</option><option value="'+t.const.BORDER_COLOR_DARK_GREY+'" '+(a.color==t.const.BORDER_COLOR_DARK_GREY?"selected":"")+'>Темно-серый</option><option value="'+t.const.BORDER_COLOR_DARK_BLUE+'" '+(a.color==t.const.BORDER_COLOR_DARK_BLUE?"selected":"")+'>Темно-синий</option><option value="'+t.const.BORDER_COLOR_BLUE+'" '+(a.color==t.const.BORDER_COLOR_BLUE?"selected":"")+'>Синий</option><option value="'+t.const.BORDER_COLOR_LIGHT_BLUE+'" '+(a.color==t.const.BORDER_COLOR_LIGHT_BLUE?"selected":"")+'>Светло-синий</option><option value="'+t.const.BORDER_COLOR_PURPLE+'" '+(a.color==t.const.BORDER_COLOR_PURPLE?"selected":"")+'>Фиолетовый</option><option value="'+t.const.BORDER_COLOR_RED+'" '+(a.color==t.const.BORDER_COLOR_RED?"selected":"")+'>Красный</option><option value="'+t.const.BORDER_COLOR_GREEN+'" '+(a.color==t.const.BORDER_COLOR_GREEN?"selected":"")+'>Зеленый</option><option value="'+t.const.BORDER_COLOR_NONE+'" '+(a.color==t.const.BORDER_COLOR_NONE?"selected":"")+">Безцветный</option></select></div></div>"].join(""))})},t.settings_render_source_tab=function(a,e,n,d){function i(){s.attr("data-hidden",!0),c.attr("data-hidden",!0),_.attr("data-hidden",!0),p.lib==b&&(p.widget?(s.removeAttr("data-hidden"),c.removeAttr("data-hidden")):s.removeAttr("data-hidden"))}function o(){s.button("hide"),c.button("hide"),_.button("hide"),p.lib==b&&(p.widget?(s.button("show"),c.button("show")):s.button("show"))}var l=$(['<div class="control" style="flex: 0 0 auto;">','<div class="control__caption control__caption_size_s">','<div class="control__text">Страница</div>',"</div>",'<div class="control__container">','<select class="select" name="pageid" data-fc="select" data-field="pageid" data-mode="radio-check" data-height="350"></select>',"</div>","</div>"].join("")),r=$(['<div class="control" style="flex: 0 0 auto;">','<div class="control__caption control__caption_size_s">','<div class="control__text">Виджет</div>',"</div>",'<div class="control__container control__container_horizontal">','<select class="select" name="elementid" data-fc="select" data-field="elementid" data-mode="radio-check" data-height="350"></select>',"</div>","</div>"].join("")),s=$(['<button class="button" data-fc="button" style="margin-right: 10px;">','<span class="icon icon_svg_plus"></span>',"</button>"].join("")).on("click",function(){f.widget.select("uncheck_all"),p.widget=null,o(),t.dbm(d,a,p,f)}),c=$(['<button class="button" data-fc="button" style="margin-left: 10px;">','<span class="icon icon_svg_edit"></span>',"</button>"].join("")).on("click",function(){t.dbm(d,a,p,f)}),_=$(['<button class="button" data-fc="button" style="margin-left: 10px;">','<span class="icon icon_svg_ok"></span>',"</button>"].join("")).on("click",function(){}),u=!1,p={lib:null,library:null,widget:null},f={library:l.find(".select"),widget:r.find(".select")},b="dbm";if("object"==typeof a.lib){r.find(".control__container").prepend(s),r.find(".control__container").append(c),r.find(".control__container").append(_);for(key in a.lib)a.lib[key]&&a.lib[key].library&&(a.lib[key].library.forEach(function(t){var e=$('<option value="'+t.value+'" '+(t.value==a.pageid?'selected="selected"':"")+">"+t.text+"</option>");t.value==a.pageid&&(p.lib=key,p.library=t,t.items.forEach(function(t){var e=$('<option value="'+t.value+'" '+(t.value==a.elementid?'selected="selected"':"")+">"+t.text+"</option>");f.widget.append(e),t.value==a.elementid&&(p.widget=t)})),f.library.append(e),u=!0,i()}),f.library.on("change",function(t){var e=$(this).select("value"),n=[];for(lib in a.lib)if(a.lib[lib]&&a.lib[lib].library){var d=a.lib[lib].library.filter(function(a){return a.value==e});d.length>0&&(d=d[0],p.lib=lib,p.library=d,p.widget=null,d.items&&n.push.apply(n,d.items))}r.find(".select").select("update",n),o()}),f.widget.on("change",function(a){var t=$(this).select("value");if(t){var e=p.library.items.filter(function(a){return a.value==t});e.length>0&&(e=e[0],p.widget=e)}else p.widget=null;o()}),!0);u||(s.remove(),c.remove(),_.remove()),e.push({id:"source",name:"Источник данных",active:n,content:$('<div style="display: flex; flex-direction: column; height: 100%;"></div>').append(l,r)})}},t.settings_apply=function(a,e,n){t.data.modal.find("[data-field]").each(function(){var t=$(this),d=t[t.data("fc").replace("-","_")]("value");"pageid"!=t.data("field")&&"elementid"!=t.data("field")||e[t.data("field")]==d||(n=!0),_.set(e,t.data("field"),d),_.set(a.data(),t.data("field"),d)}),a.widget("set_name"),a.widget("set_color"),n&&a.widget("set_content")},t.dbm=function(a,e,n,d){var i={left:a.offset().left,top:a.offset().top,width:a.outerWidth(),height:a.outerHeight()},o={width:$(window).outerWidth(),height:$(window).outerHeight()},l={buttons:[{name:"reload",action:"reload",icon:"icon_svg_refresh"},{name:"save",action:"save",icon:"icon_svg_save_red"},{name:"destroy",action:"destroy",icon:"icon_svg_close"},{name:"fullscreen",action:"fullscreen",icon:"icon_svg_fullscreen"}],header:{caption:"ДБМ",name:n.widget?n.widget.text:"Новый виджет"},content:{tabs:[{id:"general",name:"general",active:!0,content:""}]},size:"lg_max",position:i.left+i.width/2>o.width/2?"top left":"top right",draggable:!0,render_tabs_row:!1};t.data.modal_dbm=$('<span class="modal__"></span>').appendTo("body").modal__(l).on("reload.fc.modal",function(i){if("function"==typeof t.data.lib.dbm.saveForm){var o=t.data.modal_dbm.data()._el.card__middle_scroll.find(".asyst_editform");t.loader_add(o),setTimeout(function(){t.data.lib.dbm.saveForm(a,e,t.data.modal,n,d,function(){t.loader_remove()})},100)}}).on("save.fc.modal",function(i){if("function"==typeof t.data.lib.dbm.saveForm){var o=$(this),l=t.data.modal_dbm.data()._el.card__middle_scroll.find(".asyst_editform");t.loader_add(l),setTimeout(function(){t.data.lib.dbm.saveForm(a,e,t.data.modal,n,d,function(){t.loader_remove(),o.modal__("destroy"),"function"==typeof t.data.lib.dbm.closeForm&&t.data.lib.dbm.closeForm(a,e,t.data.modal,n,d)})},100)}}).on("showed.fc.modal",function(i){if("function"==typeof t.data.lib.dbm.loadForm){var o=t.data.modal_dbm.data()._el.card__middle_scroll.find("#general").addClass("asyst_editform");t.loader_add(o),setTimeout(function(){t.data.lib.dbm.loadForm(o,a,e,t.data.modal,n,d,function(){t.loader_remove()})},100)}}).on("hidden.fc.modal",function(i){"function"==typeof t.data.lib.dbm.closeForm&&t.data.lib.dbm.closeForm(a,e,t.data.modal,n,d)})},t.loader_add=function(a){a?a.before(t.data._el.loader):t.data._el.target.before(t.data._el.loader)},t.loader_remove=function(){t.data._el.loader.remove()},t.reload={dashboard:function(a,e){t.data=$.extend(t.data,a,{params:e}),t.init()},widgets:function(a,e,n){void 0===n&&(n=!0),t.data.grid[0].obj.options.items.map(function(t){$.extend(t.widget.data(),a,{params:e}),t.widget.widget("set_name"),t.widget.widget("set_color"),n&&t.widget.widget("set_content")})},widget:function(a,e,n,d){void 0===d&&(d=!0);var i=t.data.grid[0].obj.options.items.filter(function(t){return t._id==a});i.length>0&&(i=i[0],$.extend(i.widget.data(),e,{params:n}),i.widget.widget("set_name"),i.widget.widget("set_color"),d&&i.widget.widget("set_content"))},widget_:function(a,t,e,n){void 0===n&&(n=!0),$.extend(a.data(),t,{params:e}),a.widget("set_name"),a.widget("set_color"),n&&a.widget("set_content")},element:function(a,e,n,d){void 0===d&&(d=!0);var i=t.data.grid[0].obj.options.items.filter(function(t){return t.widget[0].obj.data.elementid==a});i.length>0&&(i=i[0],$.extend(i.widget.data(),e,{params:n}),i.widget.widget("set_name"),i.widget.widget("set_color"),d&&i.widget.widget("set_content"))},elementByName:function(a,e,n,d){void 0===d&&(d=!0);var i=t.data.grid[0].obj.options.items.filter(function(t){return t.widget[0].obj.data.elementname==a});i.length>0&&(i=i[0],$.extend(i.widget.data(),e,{params:n}),i.widget.widget("set_name"),i.widget.widget("set_color"),d&&i.widget.widget("set_content"))},title:function(a){t.set_title(a)},name:function(a){t.set_name(a)}},t.init_components=function(){t.data._el.popup_save.popup({source:t.data._el.button_more,height:300,width:250,animation:!0,select:!1,position:"bottom right"})},t.init=function(){t.loader_add(),setTimeout(function(){t.render_card(),t.init_components(),t.render_single(),t.render_grid(),t.store_to_window(),t.loader_remove()},100)},t.init(),t},DashboardGrid=function(a){var t=this._dashboard_grid={};return t.data={allowedDashboards:[],allowedText:"Только просмотр",allowedColor:null,editableDashboards:[],editableText:"Редактируемые",editableColor:"#aaa",items:[],loader:null,defaults:{itemWidth:2,itemHeight:5,x:0,y:0,editable:-1},add:null,open:null,edit:null,remove:null,search:{text:"",timer:null},grid:null},t.data=$.extend(!0,{},t.data,a),t.data._el={target:$("#"+t.data.containerid).css({height:"100%"}),input:$(['<span class="input input__has-clear" data-width="200">','<span class="input__box">','<span class="alertbox" data-fc="alertbox">','<span class="icon icon_svg_search"></span>',"</span>",'<input type="text" class="input__control">','<button class="button" type="button" data-fc="button">','<span class="icon icon_svg_close"></span>',"</button>","</span>","</span>"].join("")),radiogroup:$('<span class="radio-group radio-group_type_buttons"></span>'),button_add:$(['<button class="button button_color_blue" type="button">','<span class="icon icon_svg_plus_white"></span>','<span class="button__text mobile mobile_hide">Создать дэшборд</span>',"</button>"].join("")),content:$(['<div class="card">','<div class="card__header">','<div class="card__header-row">','<div class="card__header-column" id="filter"></div>',"</div>","</div>",'<div class="card__main">','<div class="card__middle">','<div class="card__middle-scroll">','<div id="widget-grid" class="widget-grid grid-stack" data-gs-animate="true"></div>',"</div>","</div>","</div>","</div>"].join("")),loader:$('<span class="spinner spinner_align_center"></span>')},t.render=function(){t.data._el.content.find("#filter").append(t.data._el.radiogroup),t.data._el.target.append(t.data._el.content)},t.render_filters=function(){t.data._el.radiogroup.append(t.data._el.button_add,$(['<label class="radio radio_type_button" data-fc="radio" data-checked="true">','<button class="button button_toggable_radio" type="button" data-fc="button" data-checked="true">','<span class="button__text">Все</span>',"</button>",'<input class="radio__input" type="radio" name="radio-group-button" value="-1" hidden/>',"</label>"].join("")),$(['<label class="radio radio_type_button" data-fc="radio" data-tooltip="'+t.data.allowedText+'">','<button class="button button_toggable_radio" type="button" data-fc="button">','<span class="button__text">'+t.data.allowedText+"</span>",'<span class="icon">','<span class="icon icon__circle" '+(t.data.allowedColor?'style="background-color: '+t.data.allowedColor+'"':"")+"></span>","</span>","</button>",'<input class="radio__input" type="radio" name="radio-group-button" value="0" hidden/>',"</label>"].join("")),$(['<label class="radio radio_type_button" data-fc="radio" data-tooltip="'+t.data.editableText+'">','<button class="button button_toggable_radio" type="button" data-fc="button">','<span class="button__text">'+t.data.editableText+"</span>",'<span class="icon">','<span class="icon icon__circle" '+(t.data.editableColor?'style="background-color: '+t.data.editableColor+'"':"")+"></span>","</span>","</button>",'<input class="radio__input" type="radio" name="radio-group-button" value="1" hidden/>',"</label>"].join(""))),t.data._el.radiogroup.append(t.data._el.input)},t.render_grid=function(){var a={items:t.data.items,loader:t.data.loader};t.data.grid=$("#widget-grid").widget_grid(a)},t.render_dbs=function(){t.data.allowedDashboards.forEach(function(a,e){a.visible=!0,a.collapsed=!1,a.editable=0,a.color=t.data.allowedColor,t.add_db(a),t.data.defaults.x+=t.data.defaults.itemWidth,t.data.defaults.x>=12&&(t.data.defaults.x=0,t.data.defaults.y+=t.data.defaults.itemHeight)}),t.data.editableDashboards.forEach(function(a,e){a.visible=!0,a.collapsed=!1,a.editable=1,a.color=t.data.editableColor,t.add_db(a),t.data.defaults.x+=t.data.defaults.itemWidth,t.data.defaults.x>=12&&(t.data.defaults.x=0,t.data.defaults.y+=t.data.defaults.itemHeight)}),t.data.grid.widget_grid("view_mode")},t.remove_dbs=function(){t.data.items=[],t.data.defaults.x=0,t.data.defaults.y=0,t.data.grid.widget_grid("clear")},t.remove_db=function(a){a.visible=!1,a.collapsed=$("#"+a.PageId).data().collapsed,t.data.grid.widget_grid("remove_widget",a.PageId),t.data.items=t.data.items.filter(function(t){return t._id!=a.PageId})},t.add_db=function(a){a.visible=!0;var e=[{icon:"icon_svg_dashboard",mode:"view",click:function(a,e){t.data.open&&"function"==typeof t.data.open&&t.data.open(e,function(a){},function(a){})}}];1==a.editable&&(e.push({icon:"icon_svg_edit",mode:"view",click:function(a,e){t.data.edit&&"function"==typeof t.data.edit&&t.data.edit(e,function(a){},function(a){})}}),e.push({icon:"icon_svg_trash",mode:"view",click:function(e,n){t.data.remove&&"function"==typeof t.data.edit&&t.data.remove(n,function(e){t.data.editableDashboards=t.data.editableDashboards.filter(function(a){return a.PageId!=n.id}),t.remove_db(a),t.filter_dbs()},function(a){})}}));var n={x:t.data.defaults.x,y:t.data.defaults.y,width:t.data.defaults.itemWidth,height:t.data.defaults.itemHeight,settings:{id:a.PageId,pagename:a.Name,collapsed:a.collapsed,description:a.Description,title:a.Title,editable:a.editable,color:a.color,buttons:e}};t.data.items.push(n),t.data.grid.widget_grid("add_widget",n)},t.update_db=function(a){t.data.grid.widget_grid("update_widget",a.PageId,t.data.defaults.x,t.data.defaults.y,t.data.defaults.itemWidth,t.data.defaults.itemHeight)},t.filter_dbs=function(){t.loader_add(),setTimeout(function(){t.data.defaults.x=0,t.data.defaults.y=0,t.data.allowedDashboards.forEach(function(a){a.editable=0,a.color=t.data.allowedColor,+a.editable!=+t.data.defaults.editable&&-1!=+t.data.defaults.editable||!a.Title.toLowerCase().includes(t.data.search.text.toLowerCase())?a.visible&&t.remove_db(a):(a.visible?t.update_db(a):t.add_db(a),t.data.defaults.x+=t.data.defaults.itemWidth,t.data.defaults.x>=12&&(t.data.defaults.x=0,t.data.defaults.y+=t.data.defaults.itemHeight))}),t.data.editableDashboards.forEach(function(a){a.editable=1,a.color=t.data.editableColor,+a.editable!=+t.data.defaults.editable&&-1!=+t.data.defaults.editable||!a.Title.toLowerCase().includes(t.data.search.text.toLowerCase())?a.visible&&t.remove_db(a):(a.visible?t.update_db(a):t.add_db(a),t.data.defaults.x+=t.data.defaults.itemWidth,t.data.defaults.x>=12&&(t.data.defaults.x=0,t.data.defaults.y+=t.data.defaults.itemHeight))}),t.data.grid.widget_grid("view_mode"),t.loader_remove()},100)},t.loader_add=function(){t.data._el.target.before(t.data._el.loader)},t.loader_remove=function(){t.data._el.loader.remove()},t.bind=function(){t.data._el.radiogroup.find('[data-fc="radio"]').on("click",function(){t.data.defaults.editable=$(this).radio_group("value"),t.filter_dbs()}),t.data._el.input.on("keyup",function(){clearTimeout(t.data.search.timer),t.data.search.text=$(this).input("value"),t.data.search.timer=setTimeout(function(){t.filter_dbs()},300)}),t.data._el.button_add.on("click",function(){t.data.add&&"function"==typeof t.data.add&&t.data.add(function(a){1==a.editable?(a.color=t.data.editableColor,t.data.editableDashboards.push(a)):0==a.editable&&(a.color=t.data.allowedColor,t.data.allowedDashboards.push(a)),t.add_db(a),t.data.defaults.x+=t.data.defaults.itemWidth,t.data.defaults.x>=12&&(t.data.defaults.x=0,t.data.defaults.y+=t.data.defaults.itemHeight)},function(a){})})},t.init_components=function(){t.data._el.radiogroup.radio_group(),t.data._el.button_add.button(),t.data._el.input.input(),t.data._el.input.css({flex:"0 0 auto"})},t.init=function(){t.loader_add(),setTimeout(function(){t.render(),t.render_filters(),t.render_grid(),t.render_dbs(),t.init_components(),t.bind(),t.loader_remove()},100)},t.init(),t},DocSearch=function(a){var t=this._docsearch={};return t.data={data:[],filter:{text:"",pagenum:1,doctypes:[],author:-1,entitytype:""},text:""},t.data=$.extend(!0,{},t.data,a),t.data._el={target:$("#"+t.data.containerid).css({height:"100%"}),input:$(['<span class="input input__has-clear" data-width="100%">','<span class="input__box">','<span class="alertbox" data-fc="alertbox">','<span class="icon icon_svg_search"></span>',"</span>",'<input type="text" class="input__control">','<button class="button" type="button" data-fc="button">','<span class="icon icon_svg_close"></span>',"</button>","</span>","</span>"].join("")),filters:{doctype:$('<select class="select" data-fc="select"></select>'),author:$('<select class="select" data-fc="select"></select>'),entity:$('<select class="select" data-fc="select"></select>')},count:$(['<label class="card__name">','<span class="card__name-text card__name-text_no-margin"></span>',"</label>"].join("")),row_search:$(['<div class="card__header-row card__header-row_wrap">','<div class="card__header-column card__header-column_stretch" id="doc__input"></div>',"</div>"].join("")),row_filter:$(['<div class="card__header-row">','<div class="card__header-column" id="doc__filter"></div>','<div class="card__header-column" id="doc__count"></div>',"</div>"].join("")),table:$(['<table class="table">',"<thead>","<tr>",'<td class="table__td_no_border">Тип</td>','<td class="table__td_no_border">Название файла</td>','<td class="table__td_no_border">Автор</td>','<td class="table__td_no_border">Тип карточки</td>','<td class="table__td_no_border">Наименование</td>','<td class="table__td_no_border">Дата изменения</td>','<td class="table__td_no_border">Размер</td>','<td class="table__td_no_border">Версия</td>',"</tr>","</thead>","<tbody></tbody>","</table>"].join("")),content:$(['<div class="card">','<div class="card__header" id="doc__header"></div>','<div class="card__main">','<div class="card__middle">','<div class="card__middle-scroll" id="doc__table"></div>',"</div>","</div>","</div>"].join("")),loader:$('<span class="spinner spinner_align_center"></span>')},t.data._private={rdata:Enumerable.From(t.data.data),fdata:Enumerable.From(t.data.data),tdata:Enumerable.Empty(),adata:Enumerable.Empty(),edata:Enumerable.Empty(),uniqueExtensions:Enumerable.From(t.data.data).Distinct("$.ext.toLowerCase()").OrderBy("$.ext").Select("{ext:$.ext, icon:$.icon}"),uniqueAuthors:Enumerable.From(t.data.data).Distinct("$.creationAuthorId").OrderBy("$.userName").Select("{creationAuthorId:$.creationAuthorId, userName:$.userName}").Where("$.creationAuthorId!=0"),uniqueEntities:Enumerable.From(t.data.data).Distinct("$.entityName").OrderBy("$.entityTitle").Select("{entityName:$.entityName, entityTitle:$.entityTitle}"),filters:{doctype:[],author:[],entity:[]}},t.render=function(){t.data._el.target.append(t.data._el.content)},t.render_search_line=function(){t.data.text=t.get_url_parameter("text"),t.data._el.row_search.find("#doc__input").append(t.data._el.input),t.data._el.content.find("#doc__header").append(t.data._el.row_search),t.data._el.input.find(".input__control").val(t.data.text),t.data._el.input.find(".input__control").keypress(function(a){13==a.which&&(window.location.href=t.set_url_parameter(window.location.href,"text",$(this).val()))})},t.render_filters=function(){t.data._private.uniqueExtensions.Count()>0&&(t.data._private.uniqueExtensions.ForEach(function(a){var e=$('<option value="'+a.ext+'">'+a.ext+"</option>");t.data._el.filters.doctype.append(e)}),t.data._el.filters.doctype.change(function(){t.data._private.filters.doctype=$(this).select("value"),t.set_filter(),t.render_count(),t.render_table()})),t.data._private.uniqueAuthors.Count()>0&&(t.data._private.uniqueAuthors.ForEach(function(a){var e=$('<option value="'+a.creationAuthorId+'">'+a.userName+"</option>");t.data._el.filters.author.append(e)}),t.data._el.filters.author.change(function(){t.data._private.filters.author=$(this).select("value"),t.set_filter(),t.render_count(),t.render_table()})),t.data._private.uniqueEntities.Count()>0&&(t.data._private.uniqueEntities.ForEach(function(a){var e=$('<option value="'+a.entityName+'">'+a.entityTitle+"</option>");t.data._el.filters.entity.append(e)}),t.data._el.filters.entity.change(function(){t.data._private.filters.entity=$(this).select("value"),t.set_filter(),t.render_count(),t.render_table()})),t.data._el.row_filter.find("#doc__filter").append(t.data._el.filters.doctype,t.data._el.filters.author,t.data._el.filters.entity),t.data._el.row_filter.find("#doc__count").append(t.data._el.count),t.data._el.content.find("#doc__header").append(t.data._el.row_filter)},t.render_count=function(){t.data._el.count.find(".card__name-text").text(t.data._private.fdata.Count())},t.render_table=function(){t.data._el.table.find("tbody").empty(),t.data._private.fdata.ForEach(function(a){t.data._el.table.find("tbody").append($(["<tr>",'<td><img class="doctype" src="'+a.icon+'"></td>','<td><a class="link" href="'+a.url+'" target="_blank">'+a.name+a.ext+"</a></td>","<td>"+a.userName+"</td>","<td>"+a.entityTitle+"</td>","<td>"+a.dataName+"</td>","<td>"+a.creationDate+"</td>","<td>"+filesize(a.fileLength,{base:2})+"</td>","<td>"+a.vers+"</td>","</tr>"].join("")))}),void 0===t.data._el.content.find("#doc__table .table")[0]&&t.data._el.content.find("#doc__table").append(t.data._el.table)},t.render_nodata=function(){t.data._el.table.find("tbody").empty(),t.data._el.table.find("tbody").append($(["<tr>",'<td colspan="8">Не найдено ни одного документа</td>',"</tr>"].join(""))),void 0===t.data._el.content.find("#doc__table .table")[0]&&t.data._el.content.find("#doc__table").append(t.data._el.table)},t.set_filter=function(){t.data._private.fdata=Enumerable.From(t.data.data);var a=Enumerable.Empty();t.data._private.filters.doctype&&t.data._private.filters.doctype.forEach(function(e){var n=t.data._private.fdata.Where('$.ext=="'+e+'"');a=a.Concat(n)});var e=Enumerable.Empty();t.data._private.filters.author&&t.data._private.filters.author.forEach(function(a){var n=t.data._private.fdata.Where('$.creationAuthorId=="'+a+'"');e=e.Concat(n)});var n=Enumerable.Empty();t.data._private.filters.entity&&t.data._private.filters.entity.forEach(function(a){var e=t.data._private.fdata.Where('$.entityName=="'+a+'"');n=n.Concat(e)}),0==a.Count()&&(a=Enumerable.From(t.data.data)),0==e.Count()&&(e=Enumerable.From(t.data.data)),0==n.Count()&&(n=Enumerable.From(t.data.data)),t.data._private.fdata=a.Intersect(e).Intersect(n).OrderBy("$.fileId")},t.set_url_parameter=function(a,t,e){var n="",d=a.split("?"),o=d[0],l=d[1],r="";if(l)for(d=l.split("&"),i=0;i<d.length;i++)d[i].split("=")[0]!=t&&(n+=r+d[i],r="&");return o+"?"+n+(r+""+t+"="+e)},t.get_url_parameter=function(a){a=a.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var t=new RegExp("[\\?&]"+a+"=([^&#]*)").exec(location.search);return null===t?"":decodeURIComponent(t[1].replace(/\+/g," "))},t.loader_add=function(){t.data._el.target.before(t.data._el.loader)},t.loader_remove=function(){t.data._el.loader.remove()},t.init_components=function(){t.data._el.filters.doctype.select({width:200,mode:"check",autoclose:!1,placeholder:"Тип документа"}),t.data._el.filters.author.select({width:200,mode:"check",autoclose:!1,placeholder:"Автор"}),t.data._el.filters.entity.select({width:200,mode:"check",autoclose:!1,placeholder:"Тип карточки"}),t.data._el.input.input()},t.init=function(){t.loader_add(),setTimeout(function(){t.render(),t.render_search_line(),t.data._private.rdata.Count()>0?(t.render_filters(),t.render_count(),t.render_table()):""!=t.data.text&&t.render_nodata(),t.init_components(),t.loader_remove()},100)},t.init(),t},GridView=function(a){var t=this._gridview={};return t.data={containerid:"",title:null,header:{views:[],reload:null,settings:[],search:null},render:function(){}},t.data=$.extend(!0,{},t.data,a),t.data._el={target:$("#"+t.data.containerid).css({width:"100%",height:"100%",display:"flex"}),name:$(['<label class="card__name">','<span class="card__name-text"></span>',"</label>"].join("")),select_view:$('<select class="select" data-fc="select"></select>'),button_reload:$(['<button class="button" data-fc="button" style="width: auto;">','<span class="icon icon_svg_refresh"></span>',"</button>"].join("")),button_settings:$(['<button class="button" data-fc="button" data-toggle="popup" style="width: auto;">','<span class="icon icon_svg_settings"></span>','<span class="icon icon_svg_down icon_animate"></span>',"</button>"].join("")),popup_settings:$(['<div class="popup popup_animation" data-position="bottom left" data-width="auto" style="width: auto; left: 524px; top: 50px;">','<ul class="popup__list"></ul>',"</div>"].join("")),input_search:$(['<span class="input input__has-clear" data-width="150">','<span class="input__box">','<span class="alertbox" data-fc="alertbox">','<span class="icon icon_svg_search"></span>',"</span>",'<input type="text" class="input__control">','<button class="button" type="button" data-fc="button">','<span class="icon icon_svg_close"></span>',"</button>","</span>","</span>"].join("")),button_extFilter:null,container:$('<div class="grid"></div>'),content:$(['<div class="card">','<div class="card__header">','<div class="card__header-row">','<div class="card__header-column card__header-column_start" id="grid__view"></div>','<div class="card__header-column" id="grid__actions"></div>',"</div>","</div>",'<div class="card__main">','<div class="card__middle">','<div class="card__middle-scroll" id="grid__container"></div>',"</div>","</div>","</div>"].join("")),loader:$('<span class="spinner spinner_align_center"></span>')},t.render=function(){t.data._el.target.append(t.data._el.content),t.render_container(),t.render_title(),t.render_views(),t.render_reload(),t.render_settings(),t.render_settings_popup(),t.render_search(),t.render_extFilter()},t.render_container=function(){t.data._el.content.find("#grid__container").append(t.data._el.container)},t.render_title=function(){t.data.title&&(t.data._el.name.find(".card__name-text").text(t.data.title),t.data._el.content.find("#grid__view").append(t.data._el.name))},t.render_views=function(){t.data.header.views.length>0&&(t.data.header.views.forEach(function(a){t.data._el.select_view.append($('<option value="'+a.value+'" '+(a.selected?"selected":"")+">"+a.name+"</option>"))}),t.data._el.content.find("#grid__view").append(t.data._el.select_view),t.data._el.select_view.on("change",function(){var a=$(this).val(),e=t.data.header.views.filter(function(t){return t.value==a});e.length>0&&"function"==typeof(e=e[0]).onclick&&e.onclick()}))},t.render_reload=function(){t.data.header.reload&&"function"==typeof t.data.header.reload.onclick&&(t.data._el.button_reload.on("click",t.data.header.reload.onclick),t.data._el.content.find("#grid__actions").append(t.data._el.button_reload))},t.render_settings=function(){t.data.header.settings.length>0&&t.data._el.content.find("#grid__actions").append(t.data._el.button_settings,t.data._el.popup_settings)},t.render_settings_popup=function(){t.data._el.popup_settings.find(".popup__list").empty(),t.data.header.settings.forEach(function(a){var e=$(['<li class="popup__list-item">','<span class="popup__link">',a.icon?'<span class="icon '+a.icon+'"></span>':"",'<span class="popup__text">'+a.name+"</span>","</span>","</li>"].join(""));"function"==typeof a.onclick&&e.on("click",a.onclick),t.data._el.popup_settings.find(".popup__list").append(e)})},t.render_search=function(){if(t.data.header.search){var a=!1;"function"==typeof t.data.header.search.onkeyup&&(a=!0,t.data._el.input_search.find(".input__control").on("keyup",t.data.header.search.onkeyup)),"function"==typeof t.data.header.search.onclear&&(a=!0,t.data._el.input_search.find(".button").on("click",t.data.header.search.onclear)),a&&t.data._el.content.find("#grid__actions").append(t.data._el.input_search)}},t.render_extFilter=function(){if(t.data.header.extFilter){var a=t.data.header.extFilter,e=$(['<button class="button" type="button" data-fc="button"'+(a.id?' id="'+a.id+'"':""),' data-tooltip="'+a.name+'">','<span class="icon '+a.icon+'"></span>',"</button>"].join("")).button();"function"==typeof a.onclick&&e.on("click",a.onclick),t.data._el.content.find("#grid__actions").append(e),t.data._el.button_extFilter=e}},t.menu__item_lock=function(){t.data._el.select_view.select("disable"),t.data._el.button_reload.button("disable"),t.data._el.button_settings.button("disable"),t.data._el.input_search.input("disable"),t.data._el.button_extFilter&&t.data._el.button_extFilter.button("disable")},t.menu__item_unlock=function(){t.data._el.select_view.select("enable"),t.data._el.button_reload.button("enable"),t.data._el.button_settings.button("enable"),t.data._el.input_search.input("enable"),t.data._el.button_extFilter&&t.data._el.button_extFilter.button("enable")},t.loader_add=function(){t.data._el.target.before(t.data._el.loader)},t.loader_remove=function(){t.data._el.loader.remove()},t.init_components=function(){t.data._el.select_view.select({width:"200",popup_width:"auto",mode:"radio",autoclose:!0,placeholder:"Представление"}),t.data._el.button_reload.button(),t.data._el.button_settings.button(),t.data._el.popup_settings.popup({source:t.data._el.button_settings,width:"auto"}),t.data._el.input_search.input()},t.init=function(){t.loader_add(),setTimeout(function(){t.render(),t.init_components(),"function"==typeof t.data.render&&t.data.render(),t.loader_remove()},100)},t.init(),t},GridView2=function(a){var t=this._gridview={};return t.data={containerid:"",title:null,header:{views:[],reload:null,settings:[],search:null},render:function(){}},t.data=$.extend(!0,{},t.data,a),t.data._el={target:$("#"+t.data.containerid).css({width:"100%",height:"100%",display:"flex"}),name:$(['<label class="card__name">','<span class="card__name-text"></span>',"</label>"].join("")),radio_group:$('<span class="radio-group radio-group_type_buttons"></span>'),buttons:[],input_search:$(['<span class="input input__has-clear" data-width="150">','<span class="input__box">','<span class="alertbox" data-fc="alertbox">','<span class="icon icon_svg_search"></span>',"</span>",'<input type="text" class="input__control">','<button class="button" type="button" data-fc="button">','<span class="icon icon_svg_close"></span>',"</button>","</span>","</span>"].join("")),container:$('<div class="grid"></div>'),content:$(['<div class="card">','<div class="card__header">','<div class="card__header-row">','<div class="card__header-column card__header-column_start" id="grid__view"></div>','<div class="card__header-column" id="grid__actions"></div>',"</div>","</div>",'<div class="card__main">','<div class="card__middle">','<div class="card__middle-scroll" id="grid__container"></div>',"</div>","</div>","</div>"].join("")),loader:$('<span class="spinner spinner_align_center"></span>')},t.render=function(){t.data._el.target.append(t.data._el.content),t.render_container(),t.render_title(),t.render_views(),t.render_search(),t.render_buttons()},t.render_container=function(){t.data._el.content.find("#grid__container").append(t.data._el.container)},t.render_title=function(){t.data.title&&(t.data._el.name.find(".card__name-text").text(t.data.title),t.data._el.content.find("#grid__view").append(t.data._el.name))},t.render_views=function(){t.data.header.views.length>0&&(t.data.header.views.forEach(function(a){t.data._el.radio_group.append($(['<label class="radio radio_type_button" data-fc="radio" data-tooltip="'+a.name+'" '+(a.selected?'data-checked="true"':"")+">",'<button class="button button_toggable_radio" type="button" data-fc="button">','<span class="button__text">'+a.name+"</span>","</button>",'<input class="radio__input" type="radio" name="radio-group-button" value="'+a.value+'" hidden="">',"</label>"].join("")))}),t.data._el.content.find("#grid__view").append(t.data._el.radio_group))},t.render_buttons=function(){t.data.header.extFilter&&t.data.header.settings.push(t.data.header.extFilter),t.data.header.settings.forEach(function(a){var e=$(['<button class="button" type="button" data-fc="button"'+(a.id?' id="'+a.id+'"':""),' data-tooltip="'+a.name+'">','<span class="icon '+a.icon+'"></span>',"</button>"].join(""));"function"==typeof a.onclick&&e.on("click",a.onclick),t.data._el.content.find("#grid__actions").append(e),t.data._el.buttons.push(e)})},t.render_search=function(){if(t.data.header.search){var a=!1;"function"==typeof t.data.header.search.onkeyup&&(a=!0,t.data._el.input_search.find(".input__control").on("keyup",t.data.header.search.onkeyup)),"function"==typeof t.data.header.search.onclear&&(a=!0,t.data._el.input_search.find(".button").on("click",t.data.header.search.onclear)),a&&t.data._el.content.find("#grid__actions").append(t.data._el.input_search)}},t.menu__item_lock=function(){t.data._el.radio_group.radio_group("disable"),t.data._el.input_search.input("disable"),t.data._el.buttons.map(function(a){a.button("disable")})},t.menu__item_unlock=function(){t.data._el.radio_group.radio_group("enable"),t.data._el.input_search.input("enable"),t.data._el.buttons.map(function(a){a.button("enable")})},t.loader_add=function(){t.data._el.target.before(t.data._el.loader)},t.loader_remove=function(){t.data._el.loader.remove()},t.bind=function(){t.data._el.radio_group.find('[data-fc="radio"]').on("click",function(){var a=$(this).radio_group("value"),e=t.data.header.views.filter(function(t){return t.value==a});e.length>0&&"function"==typeof(e=e[0]).onclick&&e.onclick()})},t.init_components=function(){t.data._el.radio_group.radio_group(),t.data._el.input_search.input(),t.data._el.buttons.map(function(a){a.button()})},t.init=function(){t.loader_add(),setTimeout(function(){t.render(),t.init_components(),t.bind(),"function"==typeof t.data.render&&t.data.render(),t.loader_remove()},100)},t.init(),t},GridView3=function(a){var t=this._gridview={};return t.data={containerid:"",title:null,header:{views:[],reload:null,settings:[],search:null},render:function(){},loading:!1},t.data=$.extend(!0,{},t.data,a),t.data._el={target:$("#"+t.data.containerid).css({width:"100%",height:"100%",display:"flex"}),button_toggle_left:$(['<button class="button" type="button" data-fc="button" data-toggle="left">','<span class="icon icon_svg_double_right"></span>',"</button>"].join("")),name:$(['<label class="card__name">','<span class="card__name-text"></span>',"</label>"].join("")),menu__list:$('<ul class="menu__list"></ul>'),buttons:[],input_search:$(['<span class="input input__has-clear" data-width="150">','<span class="input__box">','<span class="alertbox" data-fc="alertbox">','<span class="icon icon_svg_search"></span>',"</span>",'<input type="text" class="input__control">','<button class="button" type="button" data-fc="button">','<span class="icon icon_svg_close"></span>',"</button>","</span>","</span>"].join("")),container:$('<div class="grid"></div>'),content:$(['<div class="card">','<div class="card__header">','<div class="card__header-row">','<div class="card__header-column card__header-column_start" id="grid__view"></div>','<div class="card__header-column" id="grid__actions"></div>',"</div>","</div>",'<div class="card__main">','<div class="card__left">','<div class="menu menu_color_light" data-fc="menu"></div>',"</div>",'<div class="card__middle">','<div class="card__middle-scroll" id="grid__container"></div>',"</div>","</div>","</div>"].join("")),loader:$('<span class="spinner spinner_align_center"></span>')},t.render=function(){t.data._el.target.append(t.data._el.content),t.render_container(),t.render_title(),t.render_views(),t.render_search(),t.render_buttons()},t.render_container=function(){t.data._el.content.find("#grid__container").append(t.data._el.container)},t.render_title=function(){t.data.title&&(t.data._el.name.find(".card__name-text").text(t.data.title),t.data._el.content.find("#grid__view").append(t.data._el.button_toggle_left,t.data._el.name))},t.render_views=function(){t.data.header.views.length>0&&(t.data.header.views.forEach(function(a){t.data._el.menu__list.append($(['<li class="menu__item">','<a class="menu__item-link '+(a.selected?"menu__item-link_selected":"")+' link" data-value="'+a.value+'">','<span class="menu__item-link-content">','<span class="menu__icon icon icon_svg_list"></span>','<span class="menu__item-text">'+a.name+"</span>",a.count?'<span class="menu__item-text">'+a.count+"</span>":"","</span>","</a>","</li>"].join("")))}),t.data._el.content.find('[data-fc="menu"]').append(t.data._el.menu__list))},t.render_buttons=function(){t.data.header.extFilter&&t.data.header.settings.push(t.data.header.extFilter),t.data.header.settings.forEach(function(a){var e=$(['<button class="button" type="button" data-fc="button"'+(a.id?' id="'+a.id+'"':""),' data-tooltip="'+a.name+'">','<span class="icon '+a.icon+'"></span>',"</button>"].join(""));"function"==typeof a.onclick&&e.on("click",a.onclick),t.data._el.content.find("#grid__actions").append(e),t.data._el.buttons.push(e)})},t.render_search=function(){if(t.data.header.search){var a=!1;"function"==typeof t.data.header.search.onkeyup&&(a=!0,t.data._el.input_search.find(".input__control").on("keyup",t.data.header.search.onkeyup)),"function"==typeof t.data.header.search.onclear&&(a=!0,t.data._el.input_search.find(".button").on("click",t.data.header.search.onclear)),a&&t.data._el.content.find("#grid__actions").append(t.data._el.input_search)}},t.menu__item_lock=function(){t.data._el.input_search.input("disable"),t.data._el.buttons.map(function(a){a.button("disable")}),t.data._el.menu__list.find(".menu__item-link").addClass("menu__item-link_disabled"),t.data._el.menu__list.find(".menu__item-link_selected").removeClass("menu__item-link_disabled")},t.menu__item_unlock=function(){t.data._el.input_search.input("enable"),t.data._el.buttons.map(function(a){a.button("enable")}),t.data._el.menu__list.find(".menu__item-link").removeClass("menu__item-link_disabled")},t.loader_add=function(){t.data._el.target.before(t.data._el.loader)},t.loader_remove=function(){t.data._el.loader.remove()},t.bind=function(){t.data._el.menu__list.find(".menu__item-link").on("click",function(){if(!t.data.loading){t.data._el.menu__list.find(".menu__item-link").removeClass("menu__item-link_selected"),$(this).addClass("menu__item-link_selected");var a=$(this).data("value");t.data.header.views.map(function(a){a.selected=!1});var e=t.data.header.views.filter(function(t){return t.value==a});e.length>0&&((e=e[0]).selected=!0,"function"==typeof e.onclick&&e.onclick())}})},t.init_components=function(){t.data._el.button_toggle_left.button(),t.data._el.content.card(),t.data._el.input_search.input(),t.data._el.buttons.map(function(a){a.button()})},t.init=function(){t.loader_add(),setTimeout(function(){t.render(),t.init_components(),t.bind(),"function"==typeof t.data.render&&t.data.render(),t.loader_remove()},100)},t.init(),t},GridView4=function(a){var t=this._gridview={};return t.data={containerid:"",title:null,header:{views:[],reload:null,settings:[],search:null},render:function(){}},t.data=$.extend(!0,{},t.data,a),t.data._el={target:$("#"+t.data.containerid).css({width:"100%",height:"100%",display:"flex"}),name:$(['<label class="card__name">','<span class="card__name-text"></span>',"</label>"].join("")),radio_group:$('<span class="radio-group radio-group_type_buttons"></span>'),buttons:[],input_search:$(['<span class="input input__has-clear" data-width="150">','<span class="input__box">','<span class="alertbox" data-fc="alertbox">','<span class="icon icon_svg_search"></span>',"</span>",'<input type="text" class="input__control">','<button class="button" type="button" data-fc="button">','<span class="icon icon_svg_close"></span>',"</button>","</span>","</span>"].join("")),container:$('<div class="grid"></div>'),content:$(['<div class="card">','<div class="card__header">','<div class="card__header-row">','<div class="card__header-column card__header-column_start" id="grid__view"></div>','<div class="card__header-column" id="grid__actions"></div>',"</div>","</div>",'<div class="card__main">','<div class="card__middle">','<div class="card__middle-scroll" id="grid__container"></div>',"</div>","</div>","</div>"].join("")),loader:$('<span class="spinner spinner_align_center"></span>')},t.render=function(){t.data._el.target.append(t.data._el.content),t.render_container(),t.render_views(),t.render_search()},t.render_container=function(){t.data._el.content.find("#grid__container").append(t.data._el.container)},t.render_title=function(){t.data.title&&(t.data._el.name.find(".card__name-text").text(t.data.title),t.data._el.content.find("#grid__view").append(t.data._el.name))},t.render_views=function(){t.data.header.views.length>0&&(t.data.header.views.forEach(function(a){t.data._el.radio_group.append($(['<label class="radio radio_type_button" data-fc="radio" data-tooltip="'+a.name+'" '+(a.selected?'data-checked="true"':"")+">",'<button class="button button_toggable_radio" type="button" data-fc="button" data-checked="false">','<span class="button__text">'+a.name+"</span>","</button>",'<input class="radio__input" type="radio" name="radio-group-button" value="'+a.value+'" hidden="">',"</label>"].join("")))}),t.data._el.content.find("#grid__view").append(t.data._el.radio_group))},t.render_buttons=function(){t.data.header.extFilter&&t.data.header.settings.push(t.data.header.extFilter),t.data.header.settings.forEach(function(a){var e=$(['<button class="button" type="button" data-fc="button"'+(a.id?' id="'+a.id+'"':""),' data-tooltip="'+a.name+'">','<span class="icon '+a.icon+'"></span>',"</button>"].join(""));"function"==typeof a.onclick&&e.on("click",a.onclick),t.data._el.content.find("#grid__actions").append(e),t.data._el.buttons.push(e)})},t.render_search=function(){if(t.data.header.search){var a=!1;"function"==typeof t.data.header.search.onkeyup&&(a=!0,t.data._el.input_search.find(".input__control").on("keyup",t.data.header.search.onkeyup)),"function"==typeof t.data.header.search.onclear&&(a=!0,t.data._el.input_search.find(".button").on("click",t.data.header.search.onclear)),a&&t.data._el.content.find("#grid__actions").append(t.data._el.input_search)}},t.menu__item_lock=function(){t.data._el.radio_group.radio_group("disable"),t.data._el.input_search.input("disable"),t.data._el.buttons.map(function(a){a.button("disable")})},t.menu__item_unlock=function(){t.data._el.radio_group.radio_group("enable"),t.data._el.input_search.input("enable"),t.data._el.buttons.map(function(a){a.button("enable")})},t.loader_add=function(){t.data._el.target.before(t.data._el.loader)},t.loader_remove=function(){t.data._el.loader.remove()},t.bind=function(){t.data._el.radio_group.find('[data-fc="radio"]').on("click",function(){var a=$(this).radio_group("value"),e=t.data.header.views.filter(function(t){return t.value==a});e.length>0&&"function"==typeof(e=e[0]).onclick&&e.onclick()})},t.init_components=function(){t.data._el.radio_group.radio_group(),t.data._el.input_search.input(),t.data._el.buttons.map(function(a){a.button()})},t.init=function(){t.loader_add(),setTimeout(function(){t.render(),t.init_components(),t.bind(),"function"==typeof t.data.render&&t.data.render(),t.loader_remove()},100)},t.init(),t},GridView5=function(a){var t=this._gridview={};return t.data={containerid:"",title:null,render:function(){}},t.data=$.extend(!0,{},t.data,a),t.data._el={target:$("#"+t.data.containerid).css({width:"100%",height:"100%",display:"flex"}),name:$(['<label class="card__name">','<span class="card__name-text"></span>',"</label>"].join("")),radio_group:$('<span class="radio-group radio-group_type_buttons"></span>'),buttons:[],input_search:$(['<span class="input input__has-clear" data-width="150">','<span class="input__box">','<span class="alertbox" data-fc="alertbox">','<span class="icon icon_svg_search"></span>',"</span>",'<input type="text" class="input__control">','<button class="button" type="button" data-fc="button">','<span class="icon icon_svg_close"></span>',"</button>","</span>","</span>"].join("")),container:$('<div class="grid"></div>'),content:$(['<div class="card">','<div class="card__main">','<div class="card__middle">','<div class="card__middle-scroll" id="grid__container"></div>',"</div>","</div>","</div>"].join("")),loader:$('<span class="spinner spinner_align_center"></span>')},t.render=function(){t.data._el.target.append(t.data._el.content),t.render_container()},t.render_container=function(){t.data._el.content.find("#grid__container").append(t.data._el.container)},t.render_title=function(){t.data.title&&(t.data._el.name.find(".card__name-text").text(t.data.title),t.data._el.content.find("#grid__view").append(t.data._el.name))},t.render_views=function(){t.data.header.views.length>0&&(t.data.header.views.forEach(function(a){t.data._el.radio_group.append($(['<label class="radio radio_type_button" data-fc="radio" data-tooltip="'+a.name+'" '+(a.selected?'data-checked="true"':"")+">",'<button class="button button_toggable_radio" type="button" data-fc="button" data-checked="false">','<span class="button__text">'+a.name+"</span>","</button>",'<input class="radio__input" type="radio" name="radio-group-button" value="'+a.value+'" hidden="">',"</label>"].join("")))}),t.data._el.content.find("#grid__view").append(t.data._el.radio_group))},t.render_buttons=function(){t.data.header.extFilter&&t.data.header.settings.push(t.data.header.extFilter),t.data.header.settings.forEach(function(a){var e=$(['<button class="button" type="button" data-fc="button"'+(a.id?' id="'+a.id+'"':""),' data-tooltip="'+a.name+'">','<span class="icon '+a.icon+'"></span>',"</button>"].join(""));"function"==typeof a.onclick&&e.on("click",a.onclick),t.data._el.content.find("#grid__actions").append(e),t.data._el.buttons.push(e)})},t.render_search=function(){if(t.data.header.search){var a=!1;"function"==typeof t.data.header.search.onkeyup&&(a=!0,t.data._el.input_search.find(".input__control").on("keyup",t.data.header.search.onkeyup)),"function"==typeof t.data.header.search.onclear&&(a=!0,t.data._el.input_search.find(".button").on("click",t.data.header.search.onclear)),a&&t.data._el.content.find("#grid__actions").append(t.data._el.input_search)}},t.menu__item_lock=function(){t.data._el.radio_group.radio_group("disable"),t.data._el.input_search.input("disable"),t.data._el.buttons.map(function(a){a.button("disable")})},t.menu__item_unlock=function(){t.data._el.radio_group.radio_group("enable"),t.data._el.input_search.input("enable"),t.data._el.buttons.map(function(a){a.button("enable")})},t.loader_add=function(){t.data._el.target.before(t.data._el.loader)},t.loader_remove=function(){t.data._el.loader.remove()},t.bind=function(){t.data._el.radio_group.find('[data-fc="radio"]').on("click",function(){var a=$(this).radio_group("value"),e=t.data.header.views.filter(function(t){return t.value==a});e.length>0&&"function"==typeof(e=e[0]).onclick&&e.onclick()})},t.init_components=function(){t.data._el.radio_group.radio_group(),t.data._el.input_search.input(),t.data._el.buttons.map(function(a){a.button()})},t.init=function(){t.loader_add(),setTimeout(function(){t.render(),t.init_components(),t.bind(),"function"==typeof t.data.render&&t.data.render(),t.loader_remove()},100)},t.init(),t},GridView6=function(a){var t=this._gridview={};return t.data={containerid:"",title:null,header:{views:[],reload:null,settings:[],search:null},render:function(){},loading:!1},t.data=$.extend(!0,{},t.data,a),t.data._el={target:$("#"+t.data.containerid).css({width:"100%",height:"100%",display:"flex"}),button_toggle_left:$(['<button class="button" type="button" data-fc="button" data-toggle="left">','<span class="icon icon_svg_double_right"></span>',"</button>"].join("")),name:$(['<label class="card__name">','<span class="card__name-text"></span>',"</label>"].join("")),menu__list:$('<ul class="menu__list"></ul>'),buttons:[],input_search:$(['<span class="input input__has-clear" data-width="150">','<span class="input__box">','<span class="alertbox" data-fc="alertbox">','<span class="icon icon_svg_search"></span>',"</span>",'<input type="text" class="input__control">','<button class="button" type="button" data-fc="button">','<span class="icon icon_svg_close"></span>',"</button>","</span>","</span>"].join("")),container:$('<div class="grid"></div>'),content:$(['<div class="card">','<div class="card__header">','<div class="card__header-row">','<div class="card__header-column card__header-column_start" id="grid__view"></div>','<div class="card__header-column" id="grid__actions"></div>',"</div>","</div>",'<div class="card__main">','<div class="card__left">','<div class="menu menu_color_light" data-fc="menu"></div>',"</div>",'<div class="card__middle">','<div class="card__middle-scroll" id="grid__container"></div>',"</div>","</div>","</div>"].join("")),loader:$('<span class="spinner spinner_align_center"></span>')},t.render=function(){t.data._el.target.append(t.data._el.content),t.render_container(),t.render_title(),t.render_views(),t.render_search(),t.render_buttons()},t.render_container=function(){t.data._el.content.find("#grid__container").append(t.data._el.container)},t.render_title=function(){t.data.title&&(t.data._el.name.find(".card__name-text").text(t.data.title),t.data._el.content.find("#grid__view").append(t.data._el.button_toggle_left,t.data._el.name))},t.render_views=function(){t.data.header.views.length>0&&(t.data.header.views.forEach(function(a){t.data._el.menu__list.append($(['<li class="menu__item">','<a class="menu__item-link '+(a.selected?"menu__item-link_selected":"")+' link" data-value="'+a.value+'">','<span class="menu__item-link-content">','<span class="menu__icon icon icon_svg_list"></span>','<span class="menu__item-text">'+a.name+"</span>",a.count?'<span class="menu__item-text">'+a.count+"</span>":"","</span>","</a>","</li>"].join("")))}),t.data._el.content.find('[data-fc="menu"]').append(t.data._el.menu__list))},t.render_buttons=function(){t.data.header.extFilter&&t.data.header.settings.push(t.data.header.extFilter),t.data.header.extraButtons&&t.data.header.extraButtons.forEach(function(a){t.data.header.settings.push(a)}),t.data.header.settings.forEach(function(a){var e=$(['<button class="button" type="button" data-fc="button"'+(a.id?' id="'+a.id+'"':""),' data-tooltip="'+a.name+'">','<span class="icon '+a.icon+'"></span>',"</button>"].join(""));"function"==typeof a.onclick&&e.on("click",a.onclick),t.data._el.content.find("#grid__actions").append(e),t.data._el.buttons.push(e)})},t.render_search=function(){if(t.data.header.search){var a=!1;"function"==typeof t.data.header.search.onkeyup&&(a=!0,t.data._el.input_search.find(".input__control").on("keyup",t.data.header.search.onkeyup)),"function"==typeof t.data.header.search.onclear&&(a=!0,t.data._el.input_search.find(".button").on("click",t.data.header.search.onclear)),a&&t.data._el.content.find("#grid__actions").append(t.data._el.input_search)}},t.menu__item_lock=function(){t.data._el.input_search.input("disable"),t.data._el.buttons.map(function(a){a.button("disable")}),t.data._el.menu__list.find(".menu__item-link").addClass("menu__item-link_disabled"),t.data._el.menu__list.find(".menu__item-link_selected").removeClass("menu__item-link_disabled")},t.menu__item_unlock=function(){t.data._el.input_search.input("enable"),t.data._el.buttons.map(function(a){a.button("enable")}),t.data._el.menu__list.find(".menu__item-link").removeClass("menu__item-link_disabled")},t.loader_add=function(){t.data._el.target.before(t.data._el.loader)},t.loader_remove=function(){t.data._el.loader.remove()},t.bind=function(){t.data._el.menu__list.find(".menu__item-link").on("click",function(){if(!t.data.loading){t.data._el.menu__list.find(".menu__item-link").removeClass("menu__item-link_selected"),$(this).addClass("menu__item-link_selected");var a=$(this).data("value");t.data.header.views.map(function(a){a.selected=!1});var e=t.data.header.views.filter(function(t){return t.value==a});e.length>0&&((e=e[0]).selected=!0,"function"==typeof e.onclick&&e.onclick())}})},t.init_components=function(){t.data._el.button_toggle_left.button(),t.data._el.content.card(),t.data._el.input_search.input(),t.data._el.buttons.map(function(a){a.button()})},t.init=function(){t.loader_add(),setTimeout(function(){t.render(),t.init_components(),t.bind(),"function"==typeof t.data.render&&t.data.render(),t.loader_remove()},100)},t.init(),t},GridViewEmpty=function(a){var t=this._gridview={};return t.data={containerid:"",title:null,render:null},t.data=$.extend(!0,{},t.data,a),t.data._el={target:$("#"+t.data.containerid).css({width:"100%",height:"100%",display:"flex"}),name:$(['<label class="card__name">','<span class="card__name-text card__name-text_color_red"></span>',"</label>"].join("")),content:$(['<div class="card">','<div class="card__header">','<div class="card__header-row">','<div class="card__header-column card__header-column_start" id="grid__view"></div>',"</div>","</div>",'<div class="card__main">','<div class="card__middle">','<div class="card__middle-scroll" id="grid__container"></div>',"</div>","</div>","</div>"].join("")),loader:$('<span class="spinner spinner_align_center"></span>')},t.render=function(){t.data._el.target.append(t.data._el.content),t.render_title()},t.render_title=function(){t.data.title&&(t.data._el.name.find(".card__name-text").text(t.data.title),t.data._el.content.find("#grid__view").append(t.data._el.name))},t.loader_add=function(){t.data._el.target.before(t.data._el.loader)},t.loader_remove=function(){t.data._el.loader.remove()},t.init=function(){t.loader_add(),setTimeout(function(){t.render(),"function"==typeof t.data.render&&t.data.render(),t.loader_remove()},100)},t.init(),t},Reports=function(a){var t=this._reports={};return t.data={items:[],filters:[],reports:[],loader:null,defaults:{itemWidth:2,itemHeight:5,x:0,y:0,favorite:!1,reportingCategoryId:0},setFavorite:null,removeFavorite:null,search:{text:"",timer:null},grid:null},t.data=$.extend(!0,{},t.data,a),t.data._el={target:$("#"+t.data.containerid).css({height:"100%"}),tumbler:$(['<span class="tumbler">','<span class="tumbler__box">','<div class="tumbler__sticker tumbler__sticker_position_left">','<div class="tumbler__sticker-label">Вкл</div>',"</div>",'<div class="tumbler__sticker tumbler__sticker_position_right">','<div class="tumbler__sticker-label">Выкл</div>',"</div>",'<button class="button" type="button" data-fc="button">','<span class="icon icon_svg_favorite_red"></span>',"</button>","</span>",'<input class="tumbler__input" type="checkbox" name="_tumbler" hidden/>',"</span>"].join("")),input:$(['<span class="input input__has-clear" data-width="200">','<span class="input__box">','<span class="alertbox" data-fc="alertbox">','<span class="icon icon_svg_search"></span>',"</span>",'<input type="text" class="input__control">','<button class="button" type="button" data-fc="button">','<span class="icon icon_svg_close"></span>',"</button>","</span>","</span>"].join("")),radiogroup:$('<span class="radio-group radio-group_type_buttons"></span>'),content:$(['<div class="card">','<div class="card__header">','<div class="card__header-row">','<div class="card__header-column" id="filter"></div>','<div class="card__header-column" id="tumbler"></div>',"</div>","</div>",'<div class="card__main">','<div class="card__middle">','<div class="card__middle-scroll">','<div id="widget-grid" class="widget-grid grid-stack" data-gs-animate="true"></div>',"</div>","</div>","</div>","</div>"].join("")),loader:$('<span class="spinner spinner_align_center"></span>')},t.render=function(){t.data._el.content.find("#filter").append(t.data._el.radiogroup),t.data._el.content.find("#tumbler").append(t.data._el.tumbler),t.data._el.target.append(t.data._el.content)},t.render_filters=function(){t.data._el.radiogroup.append($(['<label class="radio radio_type_button" data-fc="radio" data-checked="true">','<button class="button button_toggable_radio" type="button" data-fc="button" data-checked="true">','<span class="button__text">Все</span>',"</button>",'<input class="radio__input" type="radio" name="radio-group-button" value="0" hidden/>',"</label>"].join(""))),t.data.filters.forEach(function(a){t.data._el.radiogroup.append($(['<label class="radio radio_type_button" data-fc="radio" data-tooltip="'+a.ReportingCategoryName+'">','<button class="button button_toggable_radio" type="button" data-fc="button">','<span class="button__text">'+a.ReportingCategoryName+"</span>",'<span class="icon">','<span class="icon icon__circle" style="background-color: '+a.Color+'"></span>',"</span>","</button>",'<input class="radio__input" type="radio" name="radio-group-button" value="'+a.ReportingCategoryId+'" hidden/>',"</label>"].join("")))}),t.data._el.radiogroup.append(t.data._el.input)},t.render_grid=function(){var a={items:t.data.items,loader:t.data.loader};t.data.grid=$("#widget-grid").widget_grid(a)},t.render_reports=function(){t.data.reports.forEach(function(a,e){a.visible=!0,a.collapsed=!1,t.add_report(a),t.data.defaults.x+=t.data.defaults.itemWidth,t.data.defaults.x>=12&&(t.data.defaults.x=0,t.data.defaults.y+=t.data.defaults.itemHeight)}),t.data.grid.widget_grid("view_mode")},t.remove_reports=function(){t.data.items=[],t.data.defaults.x=0,t.data.defaults.y=0,t.data.grid.widget_grid("clear")},t.remove_report=function(a){a.visible=!1,a.collapsed=$("#"+a.ReportingId).data().collapsed,t.data.grid.widget_grid("remove_widget",a.ReportingId),t.data.items=t.data.items.filter(function(t){return t._id!=a.ReportingId})},t.add_report=function(a){a.visible=!0;var e={x:t.data.defaults.x,y:t.data.defaults.y,width:t.data.defaults.itemWidth,height:t.data.defaults.itemHeight,settings:{id:a.ReportingId,name:a.Title,collapsed:a.collapsed,color:a.Color,url:a.URL,previewUrl:a.PreviewURL,repFavoriteId:a.repFavoriteId,buttons:[{icon:a.repFavoriteId?"icon_svg_favorite_red":"icon_svg_favorite",tooltip:a.repFavoriteId?"Убрать из избранного":"Добавить в избранное",mode:"view",click:function(a,e){t.toggle_favorite(a,e),e.repFavoriteId?t.data.removeFavorite&&"function"==typeof t.data.removeFavorite&&t.data.removeFavorite(e,function(a){t.data.reports.filter(function(a){return a.ReportingId==e.id})[0].repFavoriteId=null},function(n){t.toggle_favorite(a,e)}):t.data.setFavorite&&"function"==typeof t.data.setFavorite&&t.data.setFavorite(e,function(n){a.data().repFavoriteId=n.id,t.data.reports.filter(function(a){return a.ReportingId==e.id})[0].repFavoriteId=n.id},function(n){t.toggle_favorite(a,e)})}}]}};t.data.items.push(e),t.data.grid.widget_grid("add_widget",e)},t.update_report=function(a){t.data.grid.widget_grid("update_widget",a.ReportingId,t.data.defaults.x,t.data.defaults.y,t.data.defaults.itemWidth,t.data.defaults.itemHeight)},t.filter_reports=function(){t.loader_add(),setTimeout(function(){t.data.defaults.x=0,t.data.defaults.y=0,t.data.reports.forEach(function(a){(+a.ReportingCategoryId==+t.data.defaults.reportingCategoryId||0==+t.data.defaults.reportingCategoryId)&&(t.data.defaults.favorite&&a.repFavoriteId||!t.data.defaults.favorite)&&a.Title.toLowerCase().indexOf(t.data.search.text.toLowerCase())>=0?(a.visible?t.update_report(a):t.add_report(a),t.data.defaults.x+=t.data.defaults.itemWidth,t.data.defaults.x>=12&&(t.data.defaults.x=0,t.data.defaults.y+=t.data.defaults.itemHeight)):a.visible&&t.remove_report(a)}),t.data.grid.widget_grid("view_mode"),t.loader_remove()},100)},t.toggle_favorite=function(a,e){var n=a.data()._el.buttons[0].find(".icon"),d=a.data()._el.buttons[0];n.attr("class",n.attr("class").replace(/\icon_svg_favorite.*?\b/g,"")),e.repFavoriteId?(n.addClass("icon_svg_favorite"),d.tooltip("update","Добавить в избранное"),a.data().repFavoriteId=null):(n.addClass("icon_svg_favorite_red"),d.tooltip("update","Убрать из избранного"),a.data().repFavoriteId=!0),d.tooltip("hide"),t.data.reports.filter(function(a){return a.ReportingId==e.id})[0].repFavoriteId=a.data().repFavoriteId,t.filter_reports()},t.loader_add=function(){t.data._el.target.before(t.data._el.loader)},t.loader_remove=function(){t.data._el.loader.remove()},t.bind=function(){t.data._el.radiogroup.find('[data-fc="radio"]').on("click",function(){t.data.defaults.reportingCategoryId=$(this).radio_group("value"),t.filter_reports()}),t.data._el.tumbler.on("on.fc.tumbler",function(){t.data.defaults.favorite=!0,t.filter_reports()}).on("off.fc.tumbler",function(){t.data.defaults.favorite=!1,t.filter_reports()}),t.data.defaults.favorite&&t.data._el.tumbler.tumbler("check"),t.data._el.input.on("keyup",function(){clearTimeout(t.data.search.timer),t.data.search.text=$(this).input("value"),t.data.search.timer=setTimeout(function(){t.filter_reports()},300)})},t.init_components=function(){t.data._el.radiogroup.radio_group(),t.data._el.input.input(),t.data._el.tumbler.tumbler(),t.data._el.input.css({flex:"0 0 auto"})},t.init=function(){t.loader_add(),setTimeout(function(){t.render(),t.render_filters(),t.render_grid(),t.render_reports(),t.init_components(),t.bind(),t.loader_remove()},100)},t.init(),t},GridBoard=function(a){var t=this._gridboard={};return t.data={title:null,margin:!0,allowSearch:!0,items:[],loader:null,defaults:{itemWidth:3,itemHeight:3,x:0,y:0},search:{text:"",timer:null},grid:null,data:[]},t.data=$.extend(!0,{},t.data,a),t.data._el={target:$("#"+t.data.containerid).css({height:"100%"}),input:$(['<span class="input input__has-clear" data-width="200">','<span class="input__box">','<span class="alertbox" data-fc="alertbox">','<span class="icon icon_svg_search"></span>',"</span>",'<input type="text" class="input__control">','<button class="button" type="button" data-fc="button">','<span class="icon icon_svg_close"></span>',"</button>","</span>","</span>"].join("")),content:$(['<div class="card">','<div class="card__header">','<div class="card__header-row">','<div class="card__header-column" id="name">','<label class="card__name"><span class="card__name-text"></span></label>',"</div>",'<div class="card__header-column" id="search"></div>',"</div>","</div>",'<div class="card__main">','<div class="card__middle">','<div class="card__middle-scroll">',"</div>","</div>","</div>","</div>"].join("")),widget_grid:$('<div class="widget-grid grid-stack" data-gs-animate="true"></div>'),loader:$('<span class="spinner spinner_align_center"></span>')},t.render=function(){t.data.title||t.data.allowSearch||t.data._el.content.closestChild(".card__header").remove(),t.data._el.target.append(t.data._el.content)},t.render_title=function(){t.data.title&&t.data._el.content.closestChild("#name .card__name-text").html(t.data.title)},t.render_filters=function(){t.data.allowSearch&&t.data._el.content.closestChild("#search").append(t.data._el.input)},t.render_grid=function(){var a={items:t.data.data,margin:t.data.margin,loader:t.data.loader};t.data._el.content.closestChild(".card__middle-scroll").append(t.data._el.widget_grid),t.data.grid=t.data._el.widget_grid.widget_grid(a)},t.render_items=function(){t.data.items.forEach(function(a,e){a.visible=!0,a.collapsed=!!a.collapsed,t.add_item(a),t.data.defaults.x+=t.data.defaults.itemWidth,t.data.defaults.x>=12&&(t.data.defaults.x=0,t.data.defaults.y+=t.data.defaults.itemHeight)}),t.data.grid.widget_grid("view_mode")},t.remove_items=function(){t.data.data=[],t.data.defaults.x=0,t.data.defaults.y=0,t.data.grid.widget_grid("clear")},t.remove_item=function(a){a.visible=!1,a.collapsed=$("#"+a.id).data().collapsed,t.data.grid.widget_grid("remove_widget",a.id),t.data.data=t.data.data.filter(function(t){return t._id!=a.id})},t.add_item=function(a){a.visible=!0;var e={x:t.data.defaults.x,y:t.data.defaults.y,width:t.data.defaults.itemWidth,height:t.data.defaults.itemHeight,settings:{}};e.settings=$.extend(!0,{},a,{contentFormatter:t.data.contentFormatter}),t.data.data.push(e),t.data.grid.widget_grid("add_widget",e)},t.update_item=function(a){t.data.grid.widget_grid("update_widget",a.id,t.data.defaults.x,t.data.defaults.y,t.data.defaults.itemWidth,t.data.defaults.itemHeight)},t.filter_items=function(){t.loader_add(),$("body").tooltip("clear"),setTimeout(function(){t.data.defaults.x=0,t.data.defaults.y=0,t.data.items.forEach(function(a){a.title.toLowerCase().includes(t.data.search.text.toLowerCase())?(a.visible?t.update_item(a):t.add_item(a),t.data.defaults.x+=t.data.defaults.itemWidth,t.data.defaults.x>=12&&(t.data.defaults.x=0,t.data.defaults.y+=t.data.defaults.itemHeight)):a.visible&&t.remove_item(a)}),t.data.grid.widget_grid("view_mode"),t.loader_remove()},100)},t.loader_add=function(){t.data._el.target.before(t.data._el.loader)},t.loader_remove=function(){t.data._el.loader.remove()},t.bind=function(){t.data._el.input.on("keyup",function(){clearTimeout(t.data.search.timer),t.data.search.text=$(this).input("value"),t.data.search.timer=setTimeout(function(){t.filter_items()},300)})},t.init_components=function(){t.data._el.input.input(),t.data._el.input.css({flex:"0 0 auto"})},t.init=function(){t.loader_add(),setTimeout(function(){t.render(),t.render_title(),t.render_filters(),t.render_grid(),t.render_items(),t.init_components(),t.bind(),t.loader_remove()},100)},t.init(),t},CalendarEvent=function(a){var t=this._calendar_event={};return t.data={containerid:"",events:[],title:"Календарь",api:{new:null,click:null,update:null,delete:null}},t.data=$.extend(!0,{},t.data,a),t.data._el={target:$("#"+t.data.containerid).css({width:"100%",height:"100%",display:"flex"}),card:$(['<div class="card">','<div class="card__header" style="border:none;">','<div class="card__header-row">','<div class="card__header-column card__header-column_start" id="ce__name"></div>','<div class="card__header-column" id="ce__actions"></div>',"</div>","</div>",'<div class="card__main">','<div class="card__left" style="border-top: solid 1px #474c63;">','<div class="menu menu_color_light">','<div class="menu__calendar"></div>',"</div>","</div>",'<div class="card__middle">','<div class="calendar_dark" id="ce__view">',"</div>","</div>","</div>"].join("")),card__name:$(['<label class="card__name">','<span class="card__name-text">'+t.data.title+"</span>","</label>"].join("")),card__date:$(['<label class="card__name">','<span class="card__name-text"></span>',"</label>"].join("")),button_toggle_left:$(['<button class="button" type="button" data-fc="button" data-toggle="left">','<span class="icon icon_svg_double_right"></span>',"</button>"].join("")),button_nav:$('<span class="button-group" data-fc="button-group"></span>'),button_today:$(['<button class="button" type="button" data-fc="button">','<span class="button__text">Сегодня</span>',"</button>"].join("")),button_prev:$(['<button class="button" type="button" data-fc="button">','<span class="icon icon_svg_left"></span>',"</button>"].join("")),button_next:$(['<button class="button" type="button" data-fc="button">','<span class="icon icon_svg_right"></span>',"</button>"].join("")),select_view:$(['<select class="select" data-fc="select">','<option value="month" selected>Месяц</option>','<option value="agendaWeek">Неделя</option>','<option value="agendaDay">День</option>','<option value="listWeek">Повестка дня</option>',"</select>"].join("")),radio_group:$(['<span class="radio-group radio-group_type_button" data-fc="radio-group">','<label class="radio radio_type_button" data-fc="radio">','<button class="button button_toggable_radio" type="button" data-fc="button">','<span class="button__text">Месяц</span>',"</button>",'<input class="radio__input" type="radio" name="radio-group-button" value="month" hidden="">',"</label>",'<label class="radio radio_type_button" data-fc="radio">','<button class="button button_toggable_radio" type="button" data-fc="button">','<span class="button__text">Неделя</span>',"</button>",'<input class="radio__input" type="radio" name="radio-group-button" value="agendaWeek" hidden="">',"</label>",'<label class="radio radio_type_button" data-fc="radio">','<button class="button button_toggable_radio" type="button" data-fc="button">','<span class="button__text">День</span>',"</button>",'<input class="radio__input" type="radio" name="radio-group-button" value="agendaDay" hidden="">',"</label>",'<label class="radio radio_type_button" data-fc="radio">','<button class="button button_toggable_radio" type="button" data-fc="button">','<span class="button__text">Повестка недели</span>',"</button>",'<input class="radio__input" type="radio" name="radio-group-button" value="listWeek" hidden="">',"</label>","</span>"].join("")),menu_calendar:$('<div id="ce__menu_calendar"></div>'),loader:$('<span class="spinner spinner_align_center"></span>')},t.data._today=new Date,t.data._menu_calendar=null,t.data._full_calendar=null,t.data._current={view:null,date:null,day:null,month:null,year:null},t.render=function(){t.data._el.target.append(t.data._el.card),t.render_header()},t.render_header=function(){t.data._el.card__name.find(".card__name-text").text(t.data.title),t.data._el.card.find("#ce__name").append(t.data._el.button_toggle_left,t.data._el.card__name),t.data._el.card.find("#ce__actions").append(t.data._el.card__date,t.data._el.button_nav.append(t.data._el.button_prev,t.data._el.button_today,t.data._el.button_next),t.data._el.radio_group)},t.render_card_date=function(a){var e="";"undefined"!=typeof Asyst?Asyst.date&&"function"==typeof Asyst.date.convertToGenitive&&(e=Asyst.date.convertToGenitive(Asyst.date.format(a,"dd MMMM yyyy").toLowerCase())):e=a.getDate()+"."+(a.getMonth()+1)+"."+a.getFullYear(),t.data._el.card__date.find(".card__name-text").text(e)},t.mc_render=function(){t.data._el.card.find(".menu__calendar").append(t.data._el.menu_calendar),t.data._el.menu_calendar.css({"overflow-x":"auto","border-bottom":"solid 1px #eee;"}),t.data._menu_calendar=t.data._el.menu_calendar.calendar({initDate:t.data._today,items:t.data.events,header:{render:!1},onSelect:function(a,e){t.fc_set_date(e)}})},t.mc_select=function(a){t.data._menu_calendar.data("_datepicker").selectDate(a)},t.mc_update=function(a){t.data._menu_calendar.data("initDate",t.data._current.date),t.data._menu_calendar.calendar("update",a)},t.fc_render=function(){t.data._full_calendar=t.data._el.card.find("#ce__view").fullCalendar({locale:"ru",header:!1,defaultDate:null,editable:!0,navLinks:!0,eventLimit:!0,events:t.data.events,viewRender:function(a,e){t.fc_set_title(a.title),t.data._current.view=a},navLinkDayClick:function(a,e){t.mc_select(a._d),t.data._el.radio_group.radio_group("check","agendaDay"),t.data._full_calendar.fullCalendar("changeView","agendaDay")},navLinkWeekClick:function(a,e){t.data._el.radio_group.radio_group("check","agendaWeek"),t.data._full_calendar.fullCalendar("changeView","agendaWeek")},eventRender:function(a,t){a.background&&t.css({background:a.background,"border-color":a.background})},eventClick:function(a,e,n){function d(a){t.replace(a),t.mc_update(t.data.events)}"function"==typeof t.data.api.click&&t.data.api.click(a,d)},eventResize:function(a,e,n,d,i,o){function l(a){t.replace(a),t.mc_update(t.data.events)}"function"==typeof t.data.api.update?t.data.api.update(a,l):l(a)},eventDrop:function(a,e,n,d,i,o){function l(a){a.date=a.start._d,t.replace(a),t.mc_update(t.data.events)}"function"==typeof t.data.api.update?t.data.api.update(a,l):l(a)},dayClick:function(a,e,n){function d(a){a._eid=t.data.events.length,t.data.events.push(a),t.data._full_calendar.fullCalendar("renderEvent",a,!0),t.mc_update(t.data.events)}if("function"==typeof t.data.api.new)t.data.api.new(a,d);else{var i=["#2dceb6","#5a97f2","#d644d6"];d({name:"new",title:"new",date:a._d,start:a.format(),background:i[Math.floor(3*Math.random())]})}}})},t.fc_set_date=function(a){t.data._current.date=a,t.data._current.day=a.getDate(),t.data._current.month=a.getMonth(),t.data._current.year=a.getFullYear(),t.data._full_calendar&&t.data._full_calendar.fullCalendar("gotoDate",a)},t.fc_set_size=function(){var a=t.data._el.card.find("#ce__view");t.data._full_calendar.fullCalendar("option","height",a.height())},t.fc_set_title=function(a){t.data._el.card__date.find(".card__name-text").text(a)},t.loader_add=function(){t.data._el.target.before(t.data._el.loader)},t.loader_remove=function(){t.data._el.loader.remove()},t.prepare=function(){t.data.events.map(function(a,t){a._eid=t,a.name=a.title,a.date=new Date(moment(a.start,"YYYY-MM-DD"))})},t.replace=function(a){t.data.events=t.data.events.map(function(t){return t._eid==a._eid?a:t})},t.bind=function(){t.data._el.button_today.on("click",function(){t.mc_select(t.data._today)}),t.data._el.button_prev.on("click",function(){t.data._full_calendar.fullCalendar("prev"),t.mc_select(t.data._current.view.dateProfile.date._d)}),t.data._el.button_next.on("click",function(){t.data._full_calendar.fullCalendar("next"),t.mc_select(t.data._current.view.dateProfile.date._d)}),t.data._el.select_view.on("change",function(){var a=$(this).val();t.data._full_calendar.fullCalendar("changeView",a)}),t.data._el.radio_group.on("click",function(){var a=$(this).radio_group("value");t.data._full_calendar.fullCalendar("changeView",a)}),$(window).resize(function(){t.fc_set_size()})},t.init_components=function(){t.data._el.card.card(),t.data._el.button_toggle_left.button(),t.data._el.button_today.button(),t.data._el.button_prev.button(),t.data._el.button_next.button(),t.data._el.select_view.select({width:"200",popup_width:"auto",mode:"radio",autoclose:!0}),t.data._el.radio_group.radio_group(),t.data._el.radio_group.radio_group("check","month")},t.init=function(){t.loader_add(),setTimeout(function(){t.prepare(),t.render(),t.mc_render(),t.fc_render(),t.fc_set_size(),t.init_components(),t.bind(),t.loader_remove()},100)},t.init(),t};