var Dashboard=function(t){var a=this._dashboard={};return a.const={CONTENT_LOADING:'<span class="spinner"></span>',CONTENT_NODATA:"Нет данных",CONTENT_ERROR:"Ошибка загрузки",BORDER_COLOR_BLUE:"#5a97f2",BORDER_COLOR_DEFAULT:"#ccc",BORDER_COLOR_PURPLE:"#8e6bf5",BORDER_COLOR_RED:"#ff5940",BORDER_COLOR_NONE:"transparent",CONTENT_TYPE_TEXT:"text",CONTENT_TYPE_HTML:"html",CONTENT_TYPE_COUNT:"count"},a.data={id:Date.now(),title:null,name:null,single:!1,margin:!0,editable:!0,tumblerContainerSelector:null,pageid:"",items:[],lib:{foresight:{library:[],loader:null},dbm:{library:[],loader:null}},grid:null,add:function(t){},save:function(t){},headerExtraControlsRenderer:null,params:null,type:"page",modal:null,modal_dbm:null},a.data=$.extend(a.data,t),a.data._el={target:$("#"+a.data.containerid),loader:$('<span class="spinner spinner_align_center"></span>')},a.render_card=function(){$("body").tooltip("clear"),a.data._el.tumbler&&a.data._el.tumbler.remove(),$.extend(a.data._el,{grid:$('<div class="widget-grid grid-stack" data-gs-animate="true"></div>'),card__caption:$(['<label class="card__caption">','<span class="card__caption-text"></span>',"</label>"].join("")),card__name:$(['<label class="card__name">','<span class="card__name-text"></span>',"</label>"].join("")),tumbler:$(['<span class="header__column-item tumbler" id="tumbler_edit-page">','<span class="tumbler__box">','<div class="tumbler__sticker tumbler__sticker_position_left">','<div class="tumbler__sticker-label">Вкл</div>',"</div>",'<div class="tumbler__sticker tumbler__sticker_position_right">','<div class="tumbler__sticker-label">Выкл</div>',"</div>",'<button class="button" type="button" data-fc="button">','<span class="icon icon_svg_edit"></span>','<span class="button__anim"></span>',"</button>","</span>",'<input class="tumbler__input" type="checkbox" name="_tumbler" hidden/>',"</span>"].join("")).tumbler(),button_group:$('<span class="button-group header__column-item"></span>'),button_add:$(['<button class="button button_hidden" type="button" data-hidden="true" id="button_add-widget">','<span class="icon icon_svg_plus"></span>','<span class="button__text mobile mobile_hide">Добавить</span>','<span class="button__anim"></span>',"</button>"].join("")).button(),button_save:$(['<button class="button button_hidden" type="button" data-hidden="true" id="button_save-grid">','<span class="icon icon_svg_save"></span>','<span class="button__text mobile mobile_hide">Сохранить</span>','<span class="button__anim"></span>',"</button>"].join("")).button(),card:$('<div class="card"></div>'),card__header:$(['<div class="card__header">','<div class="card__header-row card__header-row_wrap">','<div class="card__header-column" id="title"></div>','<div class="card__header-column card__header-column_start" id="actions"></div>',"</div>","</div>"].join("")),card__header_row_name:$(['<div class="card__header-row">','<div class="card__header-column" id="name"></div>',"</div>"].join("")),card__main:$(['<div class="card__main">','<div class="card__middle">','<div class="card__middle-scroll" id="card__middle-scroll">',"</div>","</div>","</div>"].join(""))}),a.data._el.target.empty(),a.data._el.target.append(a.data._el.card),a.render_card_header(),a.render_card_main()},a.render_card_header=function(){var t=!1;"page"==a.data.type&&(a.data.title?(a.render_page_title(),t=!0):a.remove_page_title()),"card"==a.data.type&&(a.data.title?(a.render_card_title(),t=!0,a.data.name?(a.render_card_header_row(),a.render_card_name()):a.remove_card_name()):a.data.name?(a.rename_card_title(),a.render_card_name(),t=!0):(a.remove_card_title(),a.remove_card_name())),a.data.editable&&(a.render_tumbler(),a.render_buttons(),a.data.tumblerContainerSelector||(t=!0)),"function"==typeof a.data.headerExtraControlsRenderer&&(a.data._el.card__header.find("#actions").append(a.data.headerExtraControlsRenderer()),t=!0),t&&a.data._el.card.append(a.data._el.card__header)},a.render_card_main=function(){a.data._el.card__main.find("#card__middle-scroll").append(a.data._el.grid),a.data._el.card.append(a.data._el.card__main)},a.render_page_title=function(){a.set_title(a.data.title),a.data._el.card__header.find("#title").append(a.data._el.card__name)},a.remove_page_title=function(){a.data._el.card__header.find("#title").remove()},a.render_card_header_row=function(){a.data._el.card__header.append(a.data._el.card__header_row_name)},a.render_card_title=function(){a.set_title(a.data.title),a.data._el.card__header.find("#title").append(a.data._el.card__caption)},a.rename_card_title=function(){a.data._el.card__header.find("#title").attr("id","name")},a.remove_card_title=function(){a.data._el.card__header.find("#title").remove()},a.render_card_name=function(){a.set_name(a.data.name),a.data._el.card__header.find("#name").append(a.data._el.card__name)},a.remove_card_name=function(){a.data._el.card__header.find("#name").remove()},a.render_tumbler=function(){a.data._el.tumbler.on("on.fc.tumbler",function(){a.loader_add(),setTimeout(function(){a.data._el.button_group.show(),a.data._el.button_add.button("show"),a.data._el.button_save.button("show"),a.data.grid.widget_grid("edit_mode"),a.data.single&&a.data.grid.widget_grid("disable"),a.loader_remove()},100)}).on("off.fc.tumbler",function(){a.loader_add(),setTimeout(function(){a.data._el.button_group.hide(),a.data._el.button_add.button("hide"),a.data._el.button_save.button("hide"),a.data.grid.widget_grid("view_mode"),a.loader_remove()},100)}),a.data.tumblerContainerSelector?$(a.data.tumblerContainerSelector).prepend(a.data._el.tumbler):a.data._el.card__header.find("#actions").prepend(a.data._el.tumbler)},a.render_buttons=function(){a.data._el.button_group.hide(),a.render_button_save(),a.render_button_add(),a.data.tumblerContainerSelector?$(a.data.tumblerContainerSelector).prepend(a.data._el.button_group):a.data._el.card__header.find("#actions").prepend(a.data._el.button_group)},a.render_button_add=function(t){a.data._el.button_add.on("click",function(){var t={x:0,y:0,width:2,height:4,settings:{name:a.data.single?a.data.pageid:"Новый виджет",collapsed:!1}};a.data.grid.widget_grid("add_widget",t,function(t){"function"==typeof a.data.add&&a.data.add(t)}),a.data.single&&a.data._el.button_add.button("unhover").remove()}),a.data.single&&t&&a.data._el.button_add.button({hidden:!1}),a.data._el.button_group.prepend(a.data._el.button_add)},a.render_button_save=function(){a.data._el.button_save.on("click",function(){a.data.grid.widget_grid("save",function(t){"function"==typeof a.data.save&&a.data.save(t),a.data._el.tumbler.tumbler("uncheck")})}),a.data._el.button_group.append(a.data._el.button_save)},a.render_single=function(){a.data.single&&a.data.items.length>0&&(a.data.items.splice(1,a.data.items.length-1),a.data._el.button_add.remove())},a.render_grid=function(){a.data.grid=a.data._el.grid.widget_grid({single:a.data.single,margin:a.data.margin,pageid:a.data.pageid,items:a.data.items,lib:a.data.lib,params:a.data.params,widget_buttons:[{id:"button_settings",icon:"icon_svg_settings",mode:"edit",click:function(t,e){a.settings(t,e)}},{id:"button_remove",icon:"icon_svg_trash",mode:"edit",click:function(t,e){a.data.grid.widget_grid("remove_widget",e.id),a.data.single&&a.render_button_add(!0)}}]})},a.store_to_window=function(){void 0===window.dashboards&&(window.dashboards=[]),window.dashboards[a.data.id]=a},a.set_title=function(t){a.data.title=t,"page"==a.data.type&&a.data._el.card__name.find(".card__name-text").html(a.data.title),"card"==a.data.type&&a.data._el.card__caption.find(".card__caption-text").html(a.data.title)},a.set_name=function(t){a.data.name=t,"card"==a.data.type&&a.data._el.card__name.find(".card__name-text").html(a.data.name)},a.settings=function(t,e){var d={buttons:[{name:"reload",action:"reload",icon:"icon_svg_refresh"},{name:"save",action:"save",icon:"icon_svg_save_red"},{name:"destroy",action:"destroy",icon:"icon_svg_close"}],header:{caption:a.data.single?"Настройки страницы":"Настройки виджета",name:e.name},content:{tabs:[]},data:e,size:"sm",position:"top center",draggable:!0};a.data.single?a.settings_render_source_tab(e,d.content.tabs,!0,t):(a.settings_render_general_tab(e,d.content.tabs,!0,t),a.settings_render_source_tab(e,d.content.tabs,!1,t)),a.data.modal=$('<span class="modal__"></span>').appendTo("body").modal__(d).on("reload.fc.modal",function(){a.settings_apply(t,e,!0)}).on("save.fc.modal",function(){a.settings_apply(t,e,!1),$(this).modal__("destroy")})},a.settings_render_general_tab=function(t,e,d,n){e.push({id:"general",name:"Основные",active:d,content:$(['<div class="control"><div class="control__caption control__caption_size_s"><div class="control__text">Скрывать</div></div><div class="control__container"><label class="checkbox" data-fc="checkbox" data-field="collapsed"'+(t.collapsed?'data-checked="true"':"")+'><input class="checkbox__input" type="checkbox" name="collapsed"/><label class="checkbox__label"></label></label></div></div><div class="control"><div class="control__caption control__caption_size_s"><div class="control__text">Заголовок</div></div><div class="control__container"><span class="input input__has-clear" data-fc="input" data-field="name"><span class="input__box"><input type="text" class="input__control" value="'+t.name+'"><button class="button" type="button" data-fc="button"><span class="icon icon_svg_close"></span></button></span></span></div></div><div class="control"><div class="control__caption control__caption_size_s"><div class="control__text">Цвет</div></div><div class="control__container"><select class="select" name="color" data-fc="select" data-field="color"><option value="'+a.const.BORDER_COLOR_DEFAULT+'" '+(t.color==a.const.BORDER_COLOR_DEFAULT?"selected":"")+'>Серый</option><option value="'+a.const.BORDER_COLOR_BLUE+'" '+(t.color==a.const.BORDER_COLOR_BLUE?"selected":"")+'>Синий</option><option value="'+a.const.BORDER_COLOR_PURPLE+'" '+(t.color==a.const.BORDER_COLOR_PURPLE?"selected":"")+'>Фиолетовый</option><option value="'+a.const.BORDER_COLOR_RED+'" '+(t.color==a.const.BORDER_COLOR_RED?"selected":"")+'>Красный</option><option value="'+a.const.BORDER_COLOR_NONE+'" '+(t.color==a.const.BORDER_COLOR_NONE?"selected":"")+">Безцветный</option></select></div></div>"].join(""))})},a.settings_render_source_tab=function(t,e,d,n){function i(){s.attr("data-hidden",!0),c.attr("data-hidden",!0),_.attr("data-hidden",!0),p.lib==f&&(p.widget?(s.removeAttr("data-hidden"),c.removeAttr("data-hidden")):s.removeAttr("data-hidden"))}function o(){s.button("hide"),c.button("hide"),_.button("hide"),p.lib==f&&(p.widget?(s.button("show"),c.button("show")):s.button("show"))}var r=$(['<div class="control" style="flex: 0 0 auto;">','<div class="control__caption control__caption_size_s">','<div class="control__text">Страница</div>',"</div>",'<div class="control__container">','<select class="select" name="pageid" data-fc="select" data-field="pageid" data-mode="radio-check" data-height="350"></select>',"</div>","</div>"].join("")),l=$(['<div class="control" style="flex: 0 0 auto;">','<div class="control__caption control__caption_size_s">','<div class="control__text">Виджет</div>',"</div>",'<div class="control__container control__container_horizontal">','<select class="select" name="elementid" data-fc="select" data-field="elementid" data-mode="radio-check" data-height="350"></select>',"</div>","</div>"].join("")),s=$(['<button class="button" data-fc="button" style="margin-right: 10px;">','<span class="icon icon_svg_plus"></span>',"</button>"].join("")).on("click",function(){l.find('[data-fc="select"]').select("uncheck_all"),p.widget=null,o(),a.dbm(n,t,p)}),c=$(['<button class="button" data-fc="button" style="margin-left: 10px;">','<span class="icon icon_svg_edit"></span>',"</button>"].join("")).on("click",function(){a.dbm(n,t,p)}),_=$(['<button class="button" data-fc="button" style="margin-left: 10px;">','<span class="icon icon_svg_ok"></span>',"</button>"].join("")).on("click",function(){}),u=!1,p={lib:null,library:null,widget:null},f="dbm";if("object"==typeof t.lib){l.find(".control__container").prepend(s),l.find(".control__container").append(c),l.find(".control__container").append(_);for(key in t.lib)t.lib[key]&&t.lib[key].library&&(t.lib[key].library.forEach(function(a){var e=$('<option value="'+a.value+'" '+(a.value==t.pageid?'selected="selected"':"")+">"+a.text+"</option>");a.value==t.pageid&&(p.lib=key,p.library=a,a.items.forEach(function(a){var e=$('<option value="'+a.value+'" '+(a.value==t.elementid?'selected="selected"':"")+">"+a.text+"</option>");l.find(".select").append(e),a.value==t.elementid&&(p.widget=a)})),r.find(".select").append(e),u=!0,i()}),r.find(".select").on("change",function(a){var e=$(this).select("value"),d=[];for(lib in t.lib)if(t.lib[lib]&&t.lib[lib].library){var n=t.lib[lib].library.filter(function(t){return t.value==e});n.length>0&&(n=n[0],p.lib=lib,p.library=n,p.widget=null,n.items&&d.push.apply(d,n.items))}l.find(".select").select("update",d),o()}),l.find(".select").on("change",function(t){var a=$(this).select("value");if(a){var e=p.library.items.filter(function(t){return t.value==a});e.length>0&&(e=e[0],p.widget=e)}else p.widget=null;o()}),!0);u&&e.push({id:"source",name:"Источник данных",active:d,content:$('<div style="display: flex; flex-direction: column; height: 100%;"></div>').append(r,l)})}},a.settings_apply=function(t,e,d){a.data.modal.find("[data-field]").each(function(){var a=$(this),n=a[a.data("fc").replace("-","_")]("value");"pageid"!=a.data("field")&&"elementid"!=a.data("field")||e[a.data("field")]==n||(d=!0),_.set(e,a.data("field"),n),_.set(t.data(),a.data("field"),n)}),t.widget("set_name"),t.widget("set_color"),d&&t.widget("set_content")},a.dbm=function(t,e,d){var n={left:t.offset().left,top:t.offset().top,width:t.outerWidth(),height:t.outerHeight()},i={width:$(window).outerWidth(),height:$(window).outerHeight()},o={buttons:[{name:"reload",action:"reload",icon:"icon_svg_refresh"},{name:"save",action:"save",icon:"icon_svg_save_red"},{name:"destroy",action:"destroy",icon:"icon_svg_close"},{name:"fullscreen",action:"fullscreen",icon:"icon_svg_fullscreen"}],header:{caption:"ДБМ",name:d.widget?d.widget.text:"Новый виджет"},content:{tabs:[{id:"general",name:"general",active:!0,content:""}]},size:"lg_max",position:n.left+n.width/2>i.width/2?"top left":"top right",draggable:!0,render_tabs_row:!1};a.data.modal_dbm=$('<span class="modal__"></span>').appendTo("body").modal__(o).on("reload.fc.modal",function(){if("function"==typeof a.data.lib.dbm.saveForm){var e=a.data.modal_dbm.data()._el.card__middle_scroll.find(".asyst_editform");a.loader_add(e),setTimeout(function(){a.data.lib.dbm.saveForm(t,d,function(){a.loader_remove()})},100)}}).on("save.fc.modal",function(){if("function"==typeof a.data.lib.dbm.saveForm){var e=$(this),n=a.data.modal_dbm.data()._el.card__middle_scroll.find(".asyst_editform");a.loader_add(n),setTimeout(function(){a.data.lib.dbm.saveForm(t,d,function(){a.loader_remove(),e.modal__("destroy"),"function"==typeof a.data.lib.dbm.closeForm&&a.data.lib.dbm.closeForm(t,d)})},100)}}).on("showed.fc.modal",function(e){if("function"==typeof a.data.lib.dbm.loadForm){var n=a.data.modal_dbm.data()._el.card__middle_scroll.find("#general").addClass("asyst_editform");a.loader_add(n),setTimeout(function(){a.data.lib.dbm.loadForm(n,t,d,function(){a.loader_remove()})},100)}})},a.loader_add=function(t){t?t.before(a.data._el.loader):a.data._el.target.before(a.data._el.loader)},a.loader_remove=function(){a.data._el.loader.remove()},a.reload={dashboard:function(t,e){a.data=$.extend(a.data,t,{params:e}),a.init()},widgets:function(t,e){a.data.grid[0].obj.options.items.map(function(a){$.extend(a.widget.data(),t,{params:e}),a.widget.widget("set_name"),a.widget.widget("set_color"),a.widget.widget("set_content")})},widget:function(t,e,d){var n=a.data.grid[0].obj.options.items.filter(function(a){return a._id==t});n.length>0&&(n=n[0],$.extend(n.widget.data(),e,{params:d}),n.widget.widget("set_name"),n.widget.widget("set_color"),n.widget.widget("set_content"))},element:function(t,e,d){var n=a.data.grid[0].obj.options.items.filter(function(a){return a.widget[0].obj.data.elementid==t});n.length>0&&(n=n[0],$.extend(n.widget.data(),e,{params:d}),n.widget.widget("set_name"),n.widget.widget("set_color"),n.widget.widget("set_content"))},title:function(t){a.set_title(t)},name:function(t){a.set_name(t)}},a.init=function(){a.loader_add(),setTimeout(function(){a.render_card(),a.render_single(),a.render_grid(),a.store_to_window(),a.loader_remove()},100)},a.init(),a},DashboardGrid=function(t){var a=this._dashboard_grid={};return a.data={allowedDashboards:[],allowedText:"Только просмотр",allowedColor:null,editableDashboards:[],editableText:"Редактируемые",editableColor:"#aaa",items:[],loader:null,defaults:{itemWidth:2,itemHeight:5,x:0,y:0,editable:-1},add:null,open:null,edit:null,remove:null,search:{text:"",timer:null},grid:null},a.data=$.extend(!0,{},a.data,t),a.data._el={target:$("#"+a.data.containerid).css({height:"100%"}),input:$(['<span class="input input__has-clear" data-width="200">','<span class="input__box">','<span class="alertbox" data-fc="alertbox">','<span class="icon icon_svg_search"></span>',"</span>",'<input type="text" class="input__control">','<button class="button" type="button" data-fc="button">','<span class="icon icon_svg_close"></span>',"</button>","</span>","</span>"].join("")),radiogroup:$('<span class="radio-group radio-group_type_buttons"></span>'),button_add:$(['<button class="button button_color_blue" type="button">','<span class="icon icon_svg_plus_white"></span>','<span class="button__text mobile mobile_hide">Создать дэшборд</span>',"</button>"].join("")),content:$(['<div class="card">','<div class="card__header">','<div class="card__header-row">','<div class="card__header-column" id="filter"></div>',"</div>","</div>",'<div class="card__main">','<div class="card__middle">','<div class="card__middle-scroll">','<div id="widget-grid" class="widget-grid grid-stack" data-gs-animate="true"></div>',"</div>","</div>","</div>","</div>"].join("")),loader:$('<span class="spinner spinner_align_center"></span>')},a.render=function(){a.data._el.content.find("#filter").append(a.data._el.radiogroup),a.data._el.target.append(a.data._el.content)},a.render_filters=function(){a.data._el.radiogroup.append(a.data._el.button_add,$(['<label class="radio radio_type_button" data-fc="radio" data-checked="true">','<button class="button button_toggable_radio" type="button" data-fc="button" data-checked="true">','<span class="button__text">Все</span>',"</button>",'<input class="radio__input" type="radio" name="radio-group-button" value="-1" hidden/>',"</label>"].join("")),$(['<label class="radio radio_type_button" data-fc="radio" data-tooltip="'+a.data.allowedText+'">','<button class="button button_toggable_radio" type="button" data-fc="button">','<span class="button__text">'+a.data.allowedText+"</span>",'<span class="icon">','<span class="icon icon__circle" '+(a.data.allowedColor?'style="background-color: '+a.data.allowedColor+'"':"")+"></span>","</span>","</button>",'<input class="radio__input" type="radio" name="radio-group-button" value="0" hidden/>',"</label>"].join("")),$(['<label class="radio radio_type_button" data-fc="radio" data-tooltip="'+a.data.editableText+'">','<button class="button button_toggable_radio" type="button" data-fc="button">','<span class="button__text">'+a.data.editableText+"</span>",'<span class="icon">','<span class="icon icon__circle" '+(a.data.editableColor?'style="background-color: '+a.data.editableColor+'"':"")+"></span>","</span>","</button>",'<input class="radio__input" type="radio" name="radio-group-button" value="1" hidden/>',"</label>"].join(""))),a.data._el.radiogroup.append(a.data._el.input)},a.render_grid=function(){var t={items:a.data.items,loader:a.data.loader};a.data.grid=$("#widget-grid").widget_grid(t)},a.render_dbs=function(){a.data.allowedDashboards.forEach(function(t,e){t.visible=!0,t.collapsed=!1,t.editable=0,t.color=a.data.allowedColor,a.add_db(t),a.data.defaults.x+=a.data.defaults.itemWidth,a.data.defaults.x>=12&&(a.data.defaults.x=0,a.data.defaults.y+=a.data.defaults.itemHeight)}),a.data.editableDashboards.forEach(function(t,e){t.visible=!0,t.collapsed=!1,t.editable=1,t.color=a.data.editableColor,a.add_db(t),a.data.defaults.x+=a.data.defaults.itemWidth,a.data.defaults.x>=12&&(a.data.defaults.x=0,a.data.defaults.y+=a.data.defaults.itemHeight)}),a.data.grid.widget_grid("view_mode")},a.remove_dbs=function(){a.data.items=[],a.data.defaults.x=0,a.data.defaults.y=0,a.data.grid.widget_grid("clear")},a.remove_db=function(t){t.visible=!1,t.collapsed=$("#"+t.PageId).data().collapsed,a.data.grid.widget_grid("remove_widget",t.PageId),a.data.items=a.data.items.filter(function(a){return a._id!=t.PageId})},a.add_db=function(t){t.visible=!0;var e=[{icon:"icon_svg_dashboard",mode:"view",click:function(t,e){a.data.open&&"function"==typeof a.data.open&&a.data.open(e,function(t){},function(t){})}}];1==t.editable&&(e.push({icon:"icon_svg_edit",mode:"view",click:function(t,e){a.data.edit&&"function"==typeof a.data.edit&&a.data.edit(e,function(t){},function(t){})}}),e.push({icon:"icon_svg_trash",mode:"view",click:function(e,d){a.data.remove&&"function"==typeof a.data.edit&&a.data.remove(d,function(e){a.data.editableDashboards=a.data.editableDashboards.filter(function(t){return t.PageId!=d.id}),a.remove_db(t),a.filter_dbs()},function(t){})}}));var d={x:a.data.defaults.x,y:a.data.defaults.y,width:a.data.defaults.itemWidth,height:a.data.defaults.itemHeight,settings:{id:t.PageId,pagename:t.Name,collapsed:t.collapsed,description:t.Description,title:t.Title,editable:t.editable,color:t.color,buttons:e}};a.data.items.push(d),a.data.grid.widget_grid("add_widget",d)},a.update_db=function(t){a.data.grid.widget_grid("update_widget",t.PageId,a.data.defaults.x,a.data.defaults.y,a.data.defaults.itemWidth,a.data.defaults.itemHeight)},a.filter_dbs=function(){a.loader_add(),setTimeout(function(){a.data.defaults.x=0,a.data.defaults.y=0,a.data.allowedDashboards.forEach(function(t){t.editable=0,t.color=a.data.allowedColor,+t.editable!=+a.data.defaults.editable&&-1!=+a.data.defaults.editable||!t.Title.toLowerCase().includes(a.data.search.text.toLowerCase())?t.visible&&a.remove_db(t):(t.visible?a.update_db(t):a.add_db(t),a.data.defaults.x+=a.data.defaults.itemWidth,a.data.defaults.x>=12&&(a.data.defaults.x=0,a.data.defaults.y+=a.data.defaults.itemHeight))}),a.data.editableDashboards.forEach(function(t){t.editable=1,t.color=a.data.editableColor,+t.editable!=+a.data.defaults.editable&&-1!=+a.data.defaults.editable||!t.Title.toLowerCase().includes(a.data.search.text.toLowerCase())?t.visible&&a.remove_db(t):(t.visible?a.update_db(t):a.add_db(t),a.data.defaults.x+=a.data.defaults.itemWidth,a.data.defaults.x>=12&&(a.data.defaults.x=0,a.data.defaults.y+=a.data.defaults.itemHeight))}),a.data.grid.widget_grid("view_mode"),a.loader_remove()},100)},a.loader_add=function(){a.data._el.target.before(a.data._el.loader)},a.loader_remove=function(){a.data._el.loader.remove()},a.bind=function(){a.data._el.radiogroup.find('[data-fc="radio"]').on("click",function(){a.data.defaults.editable=$(this).radio_group("value"),a.filter_dbs()}),a.data._el.input.on("keyup",function(){clearTimeout(a.data.search.timer),a.data.search.text=$(this).input("value"),a.data.search.timer=setTimeout(function(){a.filter_dbs()},300)}),a.data._el.button_add.on("click",function(){a.data.add&&"function"==typeof a.data.add&&a.data.add(function(t){1==t.editable?(t.color=a.data.editableColor,a.data.editableDashboards.push(t)):0==t.editable&&(t.color=a.data.allowedColor,a.data.allowedDashboards.push(t)),a.add_db(t),a.data.defaults.x+=a.data.defaults.itemWidth,a.data.defaults.x>=12&&(a.data.defaults.x=0,a.data.defaults.y+=a.data.defaults.itemHeight)},function(t){})})},a.init_components=function(){a.data._el.radiogroup.radio_group(),a.data._el.button_add.button(),a.data._el.input.input(),a.data._el.input.css({flex:"0 0 auto"})},a.init=function(){a.loader_add(),setTimeout(function(){a.render(),a.render_filters(),a.render_grid(),a.render_dbs(),a.init_components(),a.bind(),a.loader_remove()},100)},a.init(),a},DocSearch=function(t){var a=this._docsearch={};return a.data={data:[],filter:{text:"",pagenum:1,doctypes:[],author:-1,entitytype:""},text:""},a.data=$.extend(!0,{},a.data,t),a.data._el={target:$("#"+a.data.containerid).css({height:"100%"}),input:$(['<span class="input input__has-clear" data-width="100%">','<span class="input__box">','<span class="alertbox" data-fc="alertbox">','<span class="icon icon_svg_search"></span>',"</span>",'<input type="text" class="input__control">','<button class="button" type="button" data-fc="button">','<span class="icon icon_svg_close"></span>',"</button>","</span>","</span>"].join("")),filters:{doctype:$('<select class="select" data-fc="select"></select>'),author:$('<select class="select" data-fc="select"></select>'),entity:$('<select class="select" data-fc="select"></select>')},count:$(['<label class="card__name">','<span class="card__name-text card__name-text_no-margin"></span>',"</label>"].join("")),row_search:$(['<div class="card__header-row card__header-row_wrap">','<div class="card__header-column card__header-column_stretch" id="doc__input"></div>',"</div>"].join("")),row_filter:$(['<div class="card__header-row">','<div class="card__header-column" id="doc__filter"></div>','<div class="card__header-column" id="doc__count"></div>',"</div>"].join("")),table:$(['<table class="table">',"<thead>","<tr>",'<td class="table__td_no_border">Тип</td>','<td class="table__td_no_border">Название файла</td>','<td class="table__td_no_border">Автор</td>','<td class="table__td_no_border">Тип карточки</td>','<td class="table__td_no_border">Наименование</td>','<td class="table__td_no_border">Дата изменения</td>','<td class="table__td_no_border">Размер</td>','<td class="table__td_no_border">Версия</td>',"</tr>","</thead>","<tbody></tbody>","</table>"].join("")),content:$(['<div class="card">','<div class="card__header" id="doc__header"></div>','<div class="card__main">','<div class="card__middle">','<div class="card__middle-scroll" id="doc__table"></div>',"</div>","</div>","</div>"].join("")),loader:$('<span class="spinner spinner_align_center"></span>')},a.data._private={rdata:Enumerable.From(a.data.data),fdata:Enumerable.From(a.data.data),tdata:Enumerable.Empty(),adata:Enumerable.Empty(),edata:Enumerable.Empty(),uniqueExtensions:Enumerable.From(a.data.data).Distinct("$.ext.toLowerCase()").OrderBy("$.ext").Select("{ext:$.ext, icon:$.icon}"),uniqueAuthors:Enumerable.From(a.data.data).Distinct("$.creationAuthorId").OrderBy("$.userName").Select("{creationAuthorId:$.creationAuthorId, userName:$.userName}").Where("$.creationAuthorId!=0"),uniqueEntities:Enumerable.From(a.data.data).Distinct("$.entityName").OrderBy("$.entityTitle").Select("{entityName:$.entityName, entityTitle:$.entityTitle}"),filters:{doctype:[],author:[],entity:[]}},a.render=function(){a.data._el.target.append(a.data._el.content)},a.render_search_line=function(){a.data.text=a.get_url_parameter("text"),a.data._el.row_search.find("#doc__input").append(a.data._el.input),a.data._el.content.find("#doc__header").append(a.data._el.row_search),a.data._el.input.find(".input__control").val(a.data.text),a.data._el.input.find(".input__control").keypress(function(t){13==t.which&&(window.location.href=a.set_url_parameter(window.location.href,"text",$(this).val()))})},a.render_filters=function(){a.data._private.uniqueExtensions.Count()>0&&(a.data._private.uniqueExtensions.ForEach(function(t){var e=$('<option value="'+t.ext+'">'+t.ext+"</option>");a.data._el.filters.doctype.append(e)}),a.data._el.filters.doctype.change(function(){a.data._private.filters.doctype=$(this).select("value"),a.set_filter(),a.render_count(),a.render_table()})),a.data._private.uniqueAuthors.Count()>0&&(a.data._private.uniqueAuthors.ForEach(function(t){var e=$('<option value="'+t.creationAuthorId+'">'+t.userName+"</option>");a.data._el.filters.author.append(e)}),a.data._el.filters.author.change(function(){a.data._private.filters.author=$(this).select("value"),a.set_filter(),a.render_count(),a.render_table()})),a.data._private.uniqueEntities.Count()>0&&(a.data._private.uniqueEntities.ForEach(function(t){var e=$('<option value="'+t.entityName+'">'+t.entityTitle+"</option>");a.data._el.filters.entity.append(e)}),a.data._el.filters.entity.change(function(){a.data._private.filters.entity=$(this).select("value"),a.set_filter(),a.render_count(),a.render_table()})),a.data._el.row_filter.find("#doc__filter").append(a.data._el.filters.doctype,a.data._el.filters.author,a.data._el.filters.entity),a.data._el.row_filter.find("#doc__count").append(a.data._el.count),a.data._el.content.find("#doc__header").append(a.data._el.row_filter)},a.render_count=function(){a.data._el.count.find(".card__name-text").text(a.data._private.fdata.Count())},a.render_table=function(){a.data._el.table.find("tbody").empty(),a.data._private.fdata.ForEach(function(t){a.data._el.table.find("tbody").append($(["<tr>",'<td><img class="doctype" src="'+t.icon+'"></td>','<td><a class="link" href="'+t.url+'" target="_blank">'+t.name+t.ext+"</a></td>","<td>"+t.userName+"</td>","<td>"+t.entityTitle+"</td>","<td>"+t.dataName+"</td>","<td>"+t.creationDate+"</td>","<td>"+filesize(t.fileLength,{base:2})+"</td>","<td>"+t.vers+"</td>","</tr>"].join("")))}),void 0===a.data._el.content.find("#doc__table .table")[0]&&a.data._el.content.find("#doc__table").append(a.data._el.table)},a.render_nodata=function(){a.data._el.table.find("tbody").empty(),a.data._el.table.find("tbody").append($(["<tr>",'<td colspan="8">Не найдено ни одного документа</td>',"</tr>"].join(""))),void 0===a.data._el.content.find("#doc__table .table")[0]&&a.data._el.content.find("#doc__table").append(a.data._el.table)},a.set_filter=function(){a.data._private.fdata=Enumerable.From(a.data.data);var t=Enumerable.Empty();a.data._private.filters.doctype.forEach(function(e){var d=a.data._private.fdata.Where('$.ext=="'+e+'"');t=t.Concat(d)});var e=Enumerable.Empty();a.data._private.filters.author.forEach(function(t){var d=a.data._private.fdata.Where('$.creationAuthorId=="'+t+'"');e=e.Concat(d)});var d=Enumerable.Empty();a.data._private.filters.entity.forEach(function(t){var e=a.data._private.fdata.Where('$.entityName=="'+t+'"');d=d.Concat(e)}),0==t.Count()&&(t=Enumerable.From(a.data.data)),0==e.Count()&&(e=Enumerable.From(a.data.data)),0==d.Count()&&(d=Enumerable.From(a.data.data)),a.data._private.fdata=t.Intersect(e).Intersect(d).OrderBy("$.fileId")},a.set_url_parameter=function(t,a,e){var d="",n=t.split("?"),o=n[0],r=n[1],l="";if(r)for(n=r.split("&"),i=0;i<n.length;i++)n[i].split("=")[0]!=a&&(d+=l+n[i],l="&");return o+"?"+d+(l+""+a+"="+e)},a.get_url_parameter=function(t){t=t.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var a=new RegExp("[\\?&]"+t+"=([^&#]*)").exec(location.search);return null===a?"":decodeURIComponent(a[1].replace(/\+/g," "))},a.loader_add=function(){a.data._el.target.before(a.data._el.loader)},a.loader_remove=function(){a.data._el.loader.remove()},a.init_components=function(){a.data._el.filters.doctype.select({width:200,mode:"check",autoclose:!1,placeholder:"Тип документа"}),a.data._el.filters.author.select({width:200,mode:"check",autoclose:!1,placeholder:"Автор"}),a.data._el.filters.entity.select({width:200,mode:"check",autoclose:!1,placeholder:"Тип карточки"}),a.data._el.input.input()},a.init=function(){a.loader_add(),setTimeout(function(){a.render(),a.render_search_line(),a.data._private.rdata.Count()>0?(a.render_filters(),a.render_count(),a.render_table()):""!=a.data.text&&a.render_nodata(),a.init_components(),a.loader_remove()},100)},a.init(),a},GridView=function(t){var a=this._gridview={};return a.data={containerid:"",title:null,header:{views:[],reload:null,settings:[],search:null},render:function(){}},a.data=$.extend(!0,{},a.data,t),a.data._el={target:$("#"+a.data.containerid).css({height:"100%"}),name:$(['<label class="card__name">','<span class="card__name-text"></span>',"</label>"].join("")),select_view:$('<select class="select" data-fc="select"></select>'),button_reload:$(['<button class="button" data-fc="button" style="width: auto;">','<span class="icon icon_svg_refresh"></span>',"</button>"].join("")),button_settings:$(['<button class="button" data-fc="button" data-toggle="popup" style="width: auto;">','<span class="icon icon_svg_settings"></span>','<span class="icon icon_svg_down icon_animate"></span>',"</button>"].join("")),popup_settings:$(['<div class="popup popup_animation" data-position="bottom left" data-width="auto" style="width: auto; left: 524px; top: 50px;">','<ul class="popup__list"></ul>',"</div>"].join("")),input_search:$(['<span class="input input__has-clear" data-width="150">','<span class="input__box">','<span class="alertbox" data-fc="alertbox">','<span class="icon icon_svg_search"></span>',"</span>",'<input type="text" class="input__control">','<button class="button" type="button" data-fc="button">','<span class="icon icon_svg_close"></span>',"</button>","</span>","</span>"].join("")),container:$('<div class="grid"></div>'),content:$(['<div class="card">','<div class="card__header">','<div class="card__header-row">','<div class="card__header-column card__header-column_start" id="grid__view"></div>','<div class="card__header-column" id="grid__actions"></div>',"</div>","</div>",'<div class="card__main">','<div class="card__middle">','<div class="card__middle-scroll" id="grid__container"></div>',"</div>","</div>","</div>"].join("")),loader:$('<span class="spinner spinner_align_center"></span>')},a.render=function(){a.data._el.target.append(a.data._el.content),a.render_container(),a.render_title(),a.render_views(),a.render_reload(),a.render_settings(),a.render_settings_popup(),a.render_search()},a.render_container=function(){a.data._el.content.find("#grid__container").append(a.data._el.container)},a.render_title=function(){a.data.title&&(a.data._el.name.find(".card__name-text").text(a.data.title),a.data._el.content.find("#grid__view").append(a.data._el.name))},a.render_views=function(){a.data.header.views.length>0&&(a.data.header.views.forEach(function(t){a.data._el.select_view.append($('<option value="'+t.value+'" '+(t.selected?"selected":"")+">"+t.name+"</option>"))}),a.data._el.content.find("#grid__view").append(a.data._el.select_view),a.data._el.select_view.on("change",function(){var t=$(this).val(),e=a.data.header.views.filter(function(a){return a.value==t});e.length>0&&"function"==typeof(e=e[0]).onclick&&e.onclick()}))},a.render_reload=function(){a.data.header.reload&&"function"==typeof a.data.header.reload.onclick&&(a.data._el.button_reload.on("click",a.data.header.reload.onclick),a.data._el.content.find("#grid__actions").append(a.data._el.button_reload))},a.render_settings=function(){a.data.header.settings.length>0&&a.data._el.content.find("#grid__actions").append(a.data._el.button_settings,a.data._el.popup_settings)},a.render_settings_popup=function(){a.data._el.popup_settings.find(".popup__list").empty(),a.data.header.settings.forEach(function(t){var e=$(['<li class="popup__list-item">','<span class="popup__link">',t.icon?'<span class="icon '+t.icon+'"></span>':"",'<span class="popup__text">'+t.name+"</span>","</span>","</li>"].join(""));"function"==typeof t.onclick&&e.on("click",t.onclick),a.data._el.popup_settings.find(".popup__list").append(e)})},a.render_search=function(){if(a.data.header.search){var t=!1;"function"==typeof a.data.header.search.onkeyup&&(t=!0,a.data._el.input_search.find(".input__control").on("keyup",a.data.header.search.onkeyup)),"function"==typeof a.data.header.search.onclear&&(t=!0,a.data._el.input_search.find(".button").on("click",a.data.header.search.onclear)),t&&a.data._el.content.find("#grid__actions").append(a.data._el.input_search)}},a.loader_add=function(){a.data._el.target.before(a.data._el.loader)},a.loader_remove=function(){a.data._el.loader.remove()},a.init_components=function(){a.data._el.select_view.select({width:"200",popup_width:"auto",mode:"radio",autoclose:!0,placeholder:"Представление"}),a.data._el.button_reload.button(),a.data._el.button_settings.button(),a.data._el.popup_settings.popup({source:a.data._el.button_settings,width:"auto"}),a.data._el.input_search.input()},a.init=function(){a.loader_add(),setTimeout(function(){a.render(),a.init_components(),"function"==typeof a.data.render&&a.data.render(),a.loader_remove()},100)},a.init(),a},GridView2=function(t){var a=this._gridview={};return a.data={containerid:"",title:null,header:{views:[],reload:null,settings:[],search:null},render:function(){}},a.data=$.extend(!0,{},a.data,t),a.data._el={target:$("#"+a.data.containerid).css({height:"100%"}),name:$(['<label class="card__name">','<span class="card__name-text"></span>',"</label>"].join("")),radio_group:$('<span class="radio-group radio-group_type_buttons"></span>'),buttons:[],input_search:$(['<span class="input input__has-clear" data-width="150">','<span class="input__box">','<span class="alertbox" data-fc="alertbox">','<span class="icon icon_svg_search"></span>',"</span>",'<input type="text" class="input__control">','<button class="button" type="button" data-fc="button">','<span class="icon icon_svg_close"></span>',"</button>","</span>","</span>"].join("")),container:$('<div class="grid"></div>'),content:$(['<div class="card">','<div class="card__header">','<div class="card__header-row">','<div class="card__header-column card__header-column_start" id="grid__view"></div>','<div class="card__header-column" id="grid__actions"></div>',"</div>","</div>",'<div class="card__main">','<div class="card__middle">','<div class="card__middle-scroll" id="grid__container"></div>',"</div>","</div>","</div>"].join("")),loader:$('<span class="spinner spinner_align_center"></span>')},a.render=function(){a.data._el.target.append(a.data._el.content),a.render_container(),a.render_title(),a.render_views(),a.render_search(),a.render_buttons()},a.render_container=function(){a.data._el.content.find("#grid__container").append(a.data._el.container)},a.render_title=function(){a.data.title&&(a.data._el.name.find(".card__name-text").text(a.data.title),a.data._el.content.find("#grid__view").append(a.data._el.name))},a.render_views=function(){a.data.header.views.length>0&&(a.data.header.views.forEach(function(t){a.data._el.radio_group.append($(['<label class="radio radio_type_button" data-fc="radio" data-tooltip="'+t.name+'" '+(t.selected?'data-checked="true"':"")+">",'<button class="button button_toggable_radio" type="button" data-fc="button">','<span class="button__text">'+t.name+"</span>","</button>",'<input class="radio__input" type="radio" name="radio-group-button" value="'+t.value+'" hidden="">',"</label>"].join("")))}),a.data._el.content.find("#grid__view").append(a.data._el.radio_group))},a.render_buttons=function(){a.data.header.settings.forEach(function(t){var e=$(['<button class="button" type="button" data-fc="button">','<span class="icon '+t.icon+'"></span>',"</button>"].join(""));"function"==typeof t.onclick&&e.on("click",t.onclick),a.data._el.content.find("#grid__actions").append(e),a.data._el.buttons.push(e)})},a.render_search=function(){if(a.data.header.search){var t=!1;"function"==typeof a.data.header.search.onkeyup&&(t=!0,a.data._el.input_search.find(".input__control").on("keyup",a.data.header.search.onkeyup)),"function"==typeof a.data.header.search.onclear&&(t=!0,a.data._el.input_search.find(".button").on("click",a.data.header.search.onclear)),t&&a.data._el.content.find("#grid__actions").append(a.data._el.input_search)}},a.loader_add=function(){a.data._el.target.before(a.data._el.loader)},a.loader_remove=function(){a.data._el.loader.remove()},a.bind=function(){a.data._el.radio_group.find('[data-fc="radio"]').on("click",function(){var t=$(this).radio_group("value");console.log(t);var e=a.data.header.views.filter(function(a){return a.value==t});e.length>0&&"function"==typeof(e=e[0]).onclick&&e.onclick()})},a.init_components=function(){a.data._el.radio_group.radio_group(),a.data._el.input_search.input(),a.data._el.buttons.map(function(t){t.button()})},a.init=function(){a.loader_add(),setTimeout(function(){a.render(),a.init_components(),a.bind(),"function"==typeof a.data.render&&a.data.render(),a.loader_remove()},100)},a.init(),a},GridView3=function(t){var a=this._gridview={};return a.data={containerid:"",title:null,header:{views:[],reload:null,settings:[],search:null},render:function(){},loading:!1},a.data=$.extend(!0,{},a.data,t),a.data._el={target:$("#"+a.data.containerid).css({height:"100%"}),button_toggle_left:$(['<button class="button" type="button" data-fc="button" data-toggle="left">','<span class="icon icon_svg_double_right"></span>',"</button>"].join("")),name:$(['<label class="card__name">','<span class="card__name-text"></span>',"</label>"].join("")),menu__list:$('<ul class="menu__list"></ul>'),buttons:[],input_search:$(['<span class="input input__has-clear" data-width="150">','<span class="input__box">','<span class="alertbox" data-fc="alertbox">','<span class="icon icon_svg_search"></span>',"</span>",'<input type="text" class="input__control">','<button class="button" type="button" data-fc="button">','<span class="icon icon_svg_close"></span>',"</button>","</span>","</span>"].join("")),container:$('<div class="grid"></div>'),content:$(['<div class="card">','<div class="card__header">','<div class="card__header-row">','<div class="card__header-column card__header-column_start" id="grid__view"></div>','<div class="card__header-column" id="grid__actions"></div>',"</div>","</div>",'<div class="card__main">','<div class="card__left">','<div class="menu menu_color_light" data-fc="menu"> ',"</div>","</div>",'<div class="card__middle">','<div class="card__middle-scroll" id="grid__container"></div>',"</div>","</div>","</div>"].join("")),loader:$('<span class="spinner spinner_align_center"></span>')},a.render=function(){a.data._el.target.append(a.data._el.content),a.render_container(),a.render_title(),a.render_views(),a.render_search(),a.render_buttons()},a.render_container=function(){a.data._el.content.find("#grid__container").append(a.data._el.container)},a.render_title=function(){a.data.title&&(a.data._el.name.find(".card__name-text").text(a.data.title),a.data._el.content.find("#grid__view").append(a.data._el.button_toggle_left,a.data._el.name))},a.render_views=function(){a.data.header.views.length>0&&(a.data.header.views.forEach(function(t){a.data._el.menu__list.append($(['<li class="menu__item">','<a class="menu__item-link '+(t.selected?"menu__item-link_selected":"")+' link" data-value="'+t.value+'">','<span class="menu__item-link-content">','<span class="menu__icon icon icon_svg_list"></span>','<span class="menu__item-text">'+t.name+"</span>",t.count?'<span class="menu__item-text">'+t.count+"</span>":"","</span>","</a>","</li>"].join("")))}),a.data._el.content.find('[data-fc="menu"]').append(a.data._el.menu__list))},a.render_buttons=function(){a.data.header.settings.forEach(function(t){var e=$(['<button class="button" type="button" data-fc="button" data-tooltip="'+t.name+'">','<span class="icon '+t.icon+'"></span>',"</button>"].join(""));"function"==typeof t.onclick&&e.on("click",t.onclick),a.data._el.content.find("#grid__actions").append(e),a.data._el.buttons.push(e)})},a.render_search=function(){if(a.data.header.search){var t=!1;"function"==typeof a.data.header.search.onkeyup&&(t=!0,a.data._el.input_search.find(".input__control").on("keyup",a.data.header.search.onkeyup)),"function"==typeof a.data.header.search.onclear&&(t=!0,a.data._el.input_search.find(".button").on("click",a.data.header.search.onclear)),t&&a.data._el.content.find("#grid__actions").append(a.data._el.input_search)}},a.menu__item_lock=function(){a.data._el.menu__list.find(".menu__item-link").addClass("menu__item-link_disabled"),a.data._el.menu__list.find(".menu__item-link_selected").removeClass("menu__item-link_disabled")},a.menu__item_unlock=function(){a.data._el.menu__list.find(".menu__item-link").removeClass("menu__item-link_disabled")},a.loader_add=function(){a.data._el.target.before(a.data._el.loader)},a.loader_remove=function(){a.data._el.loader.remove()},a.bind=function(){a.data._el.menu__list.find(".menu__item-link").on("click",function(){if(!a.data.loading){a.data._el.menu__list.find(".menu__item-link").removeClass("menu__item-link_selected"),$(this).addClass("menu__item-link_selected");var t=$(this).data("value");console.log(t),a.data.header.views.map(function(t){t.selected=!1});var e=a.data.header.views.filter(function(a){return a.value==t});e.length>0&&((e=e[0]).selected=!0,"function"==typeof e.onclick&&e.onclick())}})},a.init_components=function(){a.data._el.button_toggle_left.button(),a.data._el.content.card(),a.data._el.input_search.input(),a.data._el.buttons.map(function(t){t.button()})},a.init=function(){a.loader_add(),setTimeout(function(){a.render(),a.init_components(),a.bind(),"function"==typeof a.data.render&&a.data.render(),a.loader_remove()},100)},a.init(),a},GridView4=function(t){var a=this._gridview={};return a.data={containerid:"",title:null,header:{views:[],reload:null,settings:[],search:null},render:function(){}},a.data=$.extend(!0,{},a.data,t),a.data._el={target:$("#"+a.data.containerid).css({height:"100%"}),name:$(['<label class="card__name">','<span class="card__name-text"></span>',"</label>"].join("")),radio_group:$('<span class="radio-group radio-group_type_buttons"></span>'),buttons:[],input_search:$(['<span class="input input__has-clear" data-width="150">','<span class="input__box">','<span class="alertbox" data-fc="alertbox">','<span class="icon icon_svg_search"></span>',"</span>",'<input type="text" class="input__control">','<button class="button" type="button" data-fc="button">','<span class="icon icon_svg_close"></span>',"</button>","</span>","</span>"].join("")),container:$('<div class="grid"></div>'),content:$(['<div class="card">','<div class="card__header">','<div class="card__header-row">','<div class="card__header-column card__header-column_start" id="grid__view"></div>','<div class="card__header-column" id="grid__actions"></div>',"</div>","</div>",'<div class="card__main">','<div class="card__middle">','<div class="card__middle-scroll" id="grid__container"></div>',"</div>","</div>","</div>"].join("")),loader:$('<span class="spinner spinner_align_center"></span>')},a.render=function(){a.data._el.target.append(a.data._el.content),a.render_container(),a.render_views(),a.render_search()},a.render_container=function(){a.data._el.content.find("#grid__container").append(a.data._el.container)},a.render_title=function(){a.data.title&&(a.data._el.name.find(".card__name-text").text(a.data.title),a.data._el.content.find("#grid__view").append(a.data._el.name))},a.render_views=function(){a.data.header.views.length>0&&(a.data.header.views.forEach(function(t){a.data._el.radio_group.append($(['<label class="radio radio_type_button" data-fc="radio" data-tooltip="'+t.name+'" '+(t.selected?'data-checked="true"':"")+">",'<button class="button button_toggable_radio" type="button" data-fc="button">','<span class="button__text">'+t.name+"</span>","</button>",'<input class="radio__input" type="radio" name="radio-group-button" value="'+t.value+'" hidden="">',"</label>"].join("")))}),a.data._el.content.find("#grid__view").append(a.data._el.radio_group))},a.render_buttons=function(){a.data.header.settings.forEach(function(t){var e=$(['<button class="button" type="button" data-fc="button">','<span class="icon '+t.icon+'"></span>',"</button>"].join(""));"function"==typeof t.onclick&&e.on("click",t.onclick),a.data._el.content.find("#grid__actions").append(e),a.data._el.buttons.push(e)})},a.render_search=function(){if(a.data.header.search){var t=!1;"function"==typeof a.data.header.search.onkeyup&&(t=!0,a.data._el.input_search.find(".input__control").on("keyup",a.data.header.search.onkeyup)),"function"==typeof a.data.header.search.onclear&&(t=!0,a.data._el.input_search.find(".button").on("click",a.data.header.search.onclear)),t&&a.data._el.content.find("#grid__actions").append(a.data._el.input_search)}},a.loader_add=function(){a.data._el.target.before(a.data._el.loader)},a.loader_remove=function(){a.data._el.loader.remove()},a.bind=function(){a.data._el.radio_group.find('[data-fc="radio"]').on("click",function(){var t=$(this).radio_group("value");console.log(t);var e=a.data.header.views.filter(function(a){return a.value==t});e.length>0&&"function"==typeof(e=e[0]).onclick&&e.onclick()})},a.init_components=function(){a.data._el.radio_group.radio_group(),a.data._el.input_search.input(),a.data._el.buttons.map(function(t){t.button()})},a.init=function(){a.loader_add(),setTimeout(function(){a.render(),a.init_components(),a.bind(),"function"==typeof a.data.render&&a.data.render(),a.loader_remove()},100)},a.init(),a},GridViewEmpty=function(t){var a=this._gridview={};return a.data={containerid:"",title:null,render:null},a.data=$.extend(!0,{},a.data,t),a.data._el={target:$("#"+a.data.containerid).css({height:"100%"}),name:$(['<label class="card__name">','<span class="card__name-text card__name-text_color_red"></span>',"</label>"].join("")),content:$(['<div class="card">','<div class="card__header">','<div class="card__header-row">','<div class="card__header-column card__header-column_start" id="grid__view"></div>',"</div>","</div>",'<div class="card__main">','<div class="card__middle">','<div class="card__middle-scroll" id="grid__container"></div>',"</div>","</div>","</div>"].join("")),loader:$('<span class="spinner spinner_align_center"></span>')},a.render=function(){a.data._el.target.append(a.data._el.content),a.render_title()},a.render_title=function(){a.data.title&&(a.data._el.name.find(".card__name-text").text(a.data.title),a.data._el.content.find("#grid__view").append(a.data._el.name))},a.loader_add=function(){a.data._el.target.before(a.data._el.loader)},a.loader_remove=function(){a.data._el.loader.remove()},a.init=function(){a.loader_add(),setTimeout(function(){a.render(),"function"==typeof a.data.render&&a.data.render(),a.loader_remove()},100)},a.init(),a},Reports=function(t){var a=this._reports={};return a.data={items:[],filters:[],reports:[],loader:null,defaults:{itemWidth:2,itemHeight:5,x:0,y:0,favorite:!1,reportingCategoryId:0},setFavorite:null,removeFavorite:null,search:{text:"",timer:null},grid:null},a.data=$.extend(!0,{},a.data,t),a.data._el={target:$("#"+a.data.containerid).css({height:"100%"}),tumbler:$(['<span class="tumbler">','<span class="tumbler__box">','<div class="tumbler__sticker tumbler__sticker_position_left">','<div class="tumbler__sticker-label">Вкл</div>',"</div>",'<div class="tumbler__sticker tumbler__sticker_position_right">','<div class="tumbler__sticker-label">Выкл</div>',"</div>",'<button class="button" type="button" data-fc="button">','<span class="icon icon_svg_favorite_red"></span>',"</button>","</span>",'<input class="tumbler__input" type="checkbox" name="_tumbler" hidden/>',"</span>"].join("")),input:$(['<span class="input input__has-clear" data-width="200">','<span class="input__box">','<span class="alertbox" data-fc="alertbox">','<span class="icon icon_svg_search"></span>',"</span>",'<input type="text" class="input__control">','<button class="button" type="button" data-fc="button">','<span class="icon icon_svg_close"></span>',"</button>","</span>","</span>"].join("")),radiogroup:$('<span class="radio-group radio-group_type_buttons"></span>'),content:$(['<div class="card">','<div class="card__header">','<div class="card__header-row">','<div class="card__header-column" id="filter"></div>','<div class="card__header-column" id="tumbler"></div>',"</div>","</div>",'<div class="card__main">','<div class="card__middle">','<div class="card__middle-scroll">','<div id="widget-grid" class="widget-grid grid-stack" data-gs-animate="true"></div>',"</div>","</div>","</div>","</div>"].join("")),loader:$('<span class="spinner spinner_align_center"></span>')},a.render=function(){a.data._el.content.find("#filter").append(a.data._el.radiogroup),a.data._el.content.find("#tumbler").append(a.data._el.tumbler),a.data._el.target.append(a.data._el.content)},a.render_filters=function(){a.data._el.radiogroup.append($(['<label class="radio radio_type_button" data-fc="radio" data-checked="true">','<button class="button button_toggable_radio" type="button" data-fc="button" data-checked="true">','<span class="button__text">Все</span>',"</button>",'<input class="radio__input" type="radio" name="radio-group-button" value="0" hidden/>',"</label>"].join(""))),a.data.filters.forEach(function(t){a.data._el.radiogroup.append($(['<label class="radio radio_type_button" data-fc="radio" data-tooltip="'+t.ReportingCategoryName+'">','<button class="button button_toggable_radio" type="button" data-fc="button">','<span class="button__text">'+t.ReportingCategoryName+"</span>",'<span class="icon">','<span class="icon icon__circle" style="background-color: '+t.Color+'"></span>',"</span>","</button>",'<input class="radio__input" type="radio" name="radio-group-button" value="'+t.ReportingCategoryId+'" hidden/>',"</label>"].join("")))}),a.data._el.radiogroup.append(a.data._el.input)},a.render_grid=function(){var t={items:a.data.items,loader:a.data.loader};a.data.grid=$("#widget-grid").widget_grid(t)},a.render_reports=function(){a.data.reports.forEach(function(t,e){t.visible=!0,t.collapsed=!1,a.add_report(t),a.data.defaults.x+=a.data.defaults.itemWidth,a.data.defaults.x>=12&&(a.data.defaults.x=0,a.data.defaults.y+=a.data.defaults.itemHeight)}),a.data.grid.widget_grid("view_mode")},a.remove_reports=function(){a.data.items=[],a.data.defaults.x=0,a.data.defaults.y=0,a.data.grid.widget_grid("clear")},a.remove_report=function(t){t.visible=!1,t.collapsed=$("#"+t.ReportingId).data().collapsed,a.data.grid.widget_grid("remove_widget",t.ReportingId),a.data.items=a.data.items.filter(function(a){return a._id!=t.ReportingId})},a.add_report=function(t){t.visible=!0;var e={x:a.data.defaults.x,y:a.data.defaults.y,width:a.data.defaults.itemWidth,height:a.data.defaults.itemHeight,settings:{id:t.ReportingId,name:t.Title,collapsed:t.collapsed,color:t.Color,url:t.ReportingUrl,previewUrl:t.PreviewURL,repFavoriteId:t.repFavoriteId,buttons:[{icon:t.repFavoriteId?"icon_svg_favorite_red":"icon_svg_favorite",tooltip:t.repFavoriteId?"Убрать из избранного":"Добавить в избранное",mode:"view",click:function(t,e){a.toggle_favorite(t,e),e.repFavoriteId?a.data.removeFavorite&&"function"==typeof a.data.removeFavorite&&a.data.removeFavorite(e,function(t){a.data.reports.filter(function(t){return t.ReportingId==e.id})[0].repFavoriteId=null},function(d){a.toggle_favorite(t,e)}):a.data.setFavorite&&"function"==typeof a.data.setFavorite&&a.data.setFavorite(e,function(d){t.data().repFavoriteId=d.id,a.data.reports.filter(function(t){return t.ReportingId==e.id})[0].repFavoriteId=d.id},function(d){a.toggle_favorite(t,e)})}}]}};a.data.items.push(e),a.data.grid.widget_grid("add_widget",e)},a.update_report=function(t){a.data.grid.widget_grid("update_widget",t.ReportingId,a.data.defaults.x,a.data.defaults.y,a.data.defaults.itemWidth,a.data.defaults.itemHeight)},a.filter_reports=function(){a.loader_add(),setTimeout(function(){a.data.defaults.x=0,a.data.defaults.y=0,a.data.reports.forEach(function(t){(+t.ReportingCategoryId==+a.data.defaults.reportingCategoryId||0==+a.data.defaults.reportingCategoryId)&&(a.data.defaults.favorite&&t.repFavoriteId||!a.data.defaults.favorite)&&t.Title.toLowerCase().indexOf(a.data.search.text.toLowerCase())>=0?(t.visible?a.update_report(t):a.add_report(t),a.data.defaults.x+=a.data.defaults.itemWidth,a.data.defaults.x>=12&&(a.data.defaults.x=0,a.data.defaults.y+=a.data.defaults.itemHeight)):t.visible&&a.remove_report(t)}),a.data.grid.widget_grid("view_mode"),a.loader_remove()},100)},a.toggle_favorite=function(t,e){var d=t.data()._el.buttons[0].find(".icon"),n=t.data()._el.buttons[0];d.attr("class",d.attr("class").replace(/\icon_svg_favorite.*?\b/g,"")),e.repFavoriteId?(d.addClass("icon_svg_favorite"),n.tooltip("update","Добавить в избранное"),t.data().repFavoriteId=null):(d.addClass("icon_svg_favorite_red"),n.tooltip("update","Убрать из избранного"),t.data().repFavoriteId=!0),n.tooltip("hide"),a.data.reports.filter(function(t){return t.ReportingId==e.id})[0].repFavoriteId=t.data().repFavoriteId,a.filter_reports()},a.loader_add=function(){a.data._el.target.before(a.data._el.loader)},a.loader_remove=function(){a.data._el.loader.remove()},a.bind=function(){a.data._el.radiogroup.find('[data-fc="radio"]').on("click",function(){a.data.defaults.reportingCategoryId=$(this).radio_group("value"),a.filter_reports()}),a.data._el.tumbler.on("on.fc.tumbler",function(){a.data.defaults.favorite=!0,a.filter_reports()}).on("off.fc.tumbler",function(){a.data.defaults.favorite=!1,a.filter_reports()}),a.data.defaults.favorite&&a.data._el.tumbler.tumbler("check"),a.data._el.input.on("keyup",function(){clearTimeout(a.data.search.timer),a.data.search.text=$(this).input("value"),a.data.search.timer=setTimeout(function(){a.filter_reports()},300)})},a.init_components=function(){a.data._el.radiogroup.radio_group(),a.data._el.input.input(),a.data._el.tumbler.tumbler(),a.data._el.input.css({flex:"0 0 auto"})},a.init=function(){a.loader_add(),setTimeout(function(){a.render(),a.render_filters(),a.render_grid(),a.render_reports(),a.init_components(),a.bind(),a.loader_remove()},100)},a.init(),a},GridBoard=function(t){var a=this._gridboard={};return a.data={title:null,margin:!0,allowSearch:!0,items:[],loader:null,defaults:{itemWidth:3,itemHeight:3,x:0,y:0},search:{text:"",timer:null},grid:null,data:[]},a.data=$.extend(!0,{},a.data,t),a.data._el={target:$("#"+a.data.containerid).css({height:"100%"}),input:$(['<span class="input input__has-clear" data-width="200">','<span class="input__box">','<span class="alertbox" data-fc="alertbox">','<span class="icon icon_svg_search"></span>',"</span>",'<input type="text" class="input__control">','<button class="button" type="button" data-fc="button">','<span class="icon icon_svg_close"></span>',"</button>","</span>","</span>"].join("")),content:$(['<div class="card">','<div class="card__header">','<div class="card__header-row">','<div class="card__header-column" id="name">','<label class="card__name"><span class="card__name-text"></span></label>',"</div>",'<div class="card__header-column" id="search"></div>',"</div>","</div>",'<div class="card__main">','<div class="card__middle">','<div class="card__middle-scroll">',"</div>","</div>","</div>","</div>"].join("")),widget_grid:$('<div class="widget-grid grid-stack" data-gs-animate="true"></div>'),loader:$('<span class="spinner spinner_align_center"></span>')},a.render=function(){a.data.title||a.data.allowSearch||a.data._el.content.closestChild(".card__header").remove(),a.data._el.target.append(a.data._el.content)},a.render_title=function(){a.data.title&&a.data._el.content.closestChild("#name .card__name-text").html(a.data.title)},a.render_filters=function(){a.data.allowSearch&&a.data._el.content.closestChild("#search").append(a.data._el.input)},a.render_grid=function(){var t={items:a.data.data,margin:a.data.margin,loader:a.data.loader};a.data._el.content.closestChild(".card__middle-scroll").append(a.data._el.widget_grid),a.data.grid=a.data._el.widget_grid.widget_grid(t)},a.render_items=function(){a.data.items.forEach(function(t,e){t.visible=!0,t.collapsed=!!t.collapsed,a.add_item(t),a.data.defaults.x+=a.data.defaults.itemWidth,a.data.defaults.x>=12&&(a.data.defaults.x=0,a.data.defaults.y+=a.data.defaults.itemHeight)}),a.data.grid.widget_grid("view_mode")},a.remove_items=function(){a.data.data=[],a.data.defaults.x=0,a.data.defaults.y=0,a.data.grid.widget_grid("clear")},a.remove_item=function(t){t.visible=!1,t.collapsed=$("#"+t.id).data().collapsed,a.data.grid.widget_grid("remove_widget",t.id),a.data.data=a.data.data.filter(function(a){return a._id!=t.id})},a.add_item=function(t){t.visible=!0;var e={x:a.data.defaults.x,y:a.data.defaults.y,width:a.data.defaults.itemWidth,height:a.data.defaults.itemHeight,settings:{}};e.settings=$.extend(!0,{},t,{contentFormatter:a.data.contentFormatter}),a.data.data.push(e),a.data.grid.widget_grid("add_widget",e)},a.update_item=function(t){a.data.grid.widget_grid("update_widget",t.id,a.data.defaults.x,a.data.defaults.y,a.data.defaults.itemWidth,a.data.defaults.itemHeight)},a.filter_items=function(){a.loader_add(),$("body").tooltip("clear"),setTimeout(function(){a.data.defaults.x=0,a.data.defaults.y=0,a.data.items.forEach(function(t){t.title.toLowerCase().includes(a.data.search.text.toLowerCase())?(t.visible?a.update_item(t):a.add_item(t),a.data.defaults.x+=a.data.defaults.itemWidth,a.data.defaults.x>=12&&(a.data.defaults.x=0,a.data.defaults.y+=a.data.defaults.itemHeight)):t.visible&&a.remove_item(t)}),a.data.grid.widget_grid("view_mode"),a.loader_remove()},100)},a.loader_add=function(){a.data._el.target.before(a.data._el.loader)},a.loader_remove=function(){a.data._el.loader.remove()},a.bind=function(){a.data._el.input.on("keyup",function(){clearTimeout(a.data.search.timer),a.data.search.text=$(this).input("value"),a.data.search.timer=setTimeout(function(){a.filter_items()},300)})},a.init_components=function(){a.data._el.input.input(),a.data._el.input.css({flex:"0 0 auto"})},a.init=function(){a.loader_add(),setTimeout(function(){a.render(),a.render_title(),a.render_filters(),a.render_grid(),a.render_items(),a.init_components(),a.bind(),a.loader_remove()},100)},a.init(),a};