!function(t){var e={init:function(e){return this.each(function(){var a=t(this),n=a.data("_widget");if(!n){a.data("_widget",{type:"calendar",target:a});var d=this.obj={};d.defaults={items:[],columns:[],events:{render:!1,TitleColumn:"date",TooltipColumn:"date",maxItems:3},renderEvents:!1,eventTitleColumn:"date",eventTooltipColumn:"date",onSelect:null,onSelectAllowed:!0,useItemsLength:!0},d.data=a.data(),d.options=t.extend(!0,{},d.defaults,d.data,e),a.data(d.options),d.data._today=new Date,d.data._datepicker=null,d.data._selectedItems=[],d.data._showModal=!1,d.data._el={target:a.addClass("calendar"),calendar__container:t('<div class="calendar__container"></div>'),card:t('<div class="card"></div>'),card__header:t(['<div class="card__header">','<div class="card__header-row">','<div class="card__header-column" id="name"></div>','<div class="card__header-column" id="actions"></div>',"</div>","</div>"].join("")),button_today:t(['<button class="button" type="button" data-fc="button">','<span class="button__text">Сегодня</span>',"</button>"].join("")),card__name:t(['<label class="card__name">','<span class="card__name-text card__name-text">'+d.data._today.getDate()+"</span>","</label>"].join("")),card__count:t(['<label class="card__name">','<span class="card__name-text">Событий: 3</span>',"</label>"].join("")),card__main:t('<div class="card__main card__main_flex-direction_column"></div>'),calendar__row_top:t('<div class="calendar__row calendar__row_top"></div>'),calendar__row_bottom:t('<div class="calendar__row calendar__row_bottom"></div>'),calendar__datepicker:t('<div class="calendar__datepicker"></div>'),calendar__table:t('<div class="calendar__table"></div>')},d.destroy=function(){a.removeData(),a.remove()},d.prepare_data=function(){d.data.items.map(function(t){for(var e in t)t.hasOwnProperty(e)&&"null"==t[e]&&(t[e]="")})},d.render=function(){d.data._el.card__header.find("#name").append(d.data._el.card__name),d.data._el.card__header.find("#actions").append(d.data._el.button_today),d.data._el.target.append(d.data._el.calendar__container.append(d.data._el.card.append(d.data._el.card__header,d.data._el.card__main.append(d.data._el.calendar__row_top.append(d.data._el.calendar__datepicker),d.data.columns.length>0?d.data._el.calendar__row_bottom.append(d.data._el.calendar__table):null))))},d.render_datepicker=function(){d.data._el.calendar__datepicker.datepicker({onRenderCell:function(t,e){if(a.find("[data-tooltip]").tooltip(),a.find("[data-tooltip]").tooltip("hide"),t){var n=t.getDate(),o=d.data.items.filter(function(t){return t.date&&"object"==typeof t.date}).filter(function(e){return e.date.getDate()==t.getDate()&&e.date.getMonth()==t.getMonth()&&e.date.getFullYear()==t.getFullYear()});if("day"==e)return d.data.events.render?{html:['<div class="datepicker__day-container">','<div class="datepicker__day-border">','<div class="datepicker__day">'+n+"</div>",o.map(function(t,e){return e<d.data.events.maxItems?['<div class="datepicker__event">','<a class="datepicker__event-link link" href="'+t.url+'" target="_blank" onclick="event.cancelBubble = true; if(event.stopPropagation){ event.stopPropagation(); }" data-tooltip="'+t[d.data.events.TooltipColumn]+'">','<div class="datepicker__indicator"><img src="/asyst/gantt/img/svg/'+t.indicator+'.svg"></div>','<div class="datepicker__event-text" ',t.background?'style="background-color: '+t.background+"; color: "+t.color+'; border: none;"':"",">"+t[d.data.events.TitleColumn]+"</div>","</a>","</div>"].join(""):""}).join(""),'<div class="datepicker__more">',o.length-d.data.events.maxItems>0?"еще "+(o.length-d.data.events.maxItems):"","</div>","</div>","</div>"].join("")}:o.length>0?d.data.useItemsLength?{html:['<div class="datepicker__day">'+n,'<div class="datepicker__note">'+o.length,"</div>","</div>"].join("")}:{html:['<a class="datepicker__day"',o[0].url?'href="'+o[0].url+'"'+(o[0].target?'target="'+o[0].target+'"':""):"",">"+n,'<div class="datepicker__note"',(o[0].background?' style="background-color:'+o[0].background+'"':"")+">"+o[0].count,"</div>","</a>"].join("")}:{html:'<div class="datepicker__day">'+n+"</div>"}}},onSelect:function(t,e){a.find("[data-tooltip]").tooltip(),a.find("[data-tooltip]").tooltip("hide"),e&&(d.data._selectedItems=d.data.items.filter(function(t){return t.date&&"object"==typeof t.date}).filter(function(t){return t.date.getDate()==e.getDate()&&t.date.getMonth()==e.getMonth()&&t.date.getFullYear()==e.getFullYear()}),d.data.date=e,d.data.formattedDate=t,d.data._el.card__name.find(".card__name-text").text(t),d.data._el.card__name.find(".card__name-text").text(t),d.data.events.render?d.data._selectedItems.length>0&&d.data._showModal&&d.render_modal():(d.data._el.calendar__table.empty().append(d.render_table()),d.data._el.calendar__table.find("[data-tooltip]").tooltip()),"function"==typeof d.data.onSelect&&d.data.onSelectAllowed&&d.data.onSelect(t,e))}}),d.data.events.render&&(d.data._el.calendar__row_bottom.remove(),d.data._el.calendar__datepicker.find(".datepicker--cells-days").addClass("datepicker__cells-days-border")),d.data._datepicker=d.data._el.calendar__datepicker.data().datepicker,d.data._datepicker.selectDate(new Date(d.data._today.getFullYear(),d.data._today.getMonth(),d.data._today.getDate())),d.data._showModal=!0},d.render_table=function(){var e=t('<table class="table"></table>'),a=t("<thead></thead>"),n=t("<tbody></tbody>"),o=t("<tr></tr>"),i=t("<td></td>");return e.append(a.append(o.clone().append(d.data.columns.map(function(t){return i.clone().html(t.title)}))),n.append(d.data._selectedItems.map(function(t){return o.clone().append(d.data.columns.map(function(e){return i.clone().html(t[e.fieldname])}))}))),e},d.render_modal=function(){var e={buttons:[{name:"destroy",action:"destroy",icon:"icon_svg_close"}],header:{caption:"События",name:d.data.formattedDate},content:{tabs:[]}};!function(e,a,n){a.push({id:"general",name:"",active:n,content:t('<div class="card__table"></div>').append(d.render_table())})}(0,e.content.tabs,!0),t('<span class="modal__"></span>').appendTo("body").modal__(e)},d.bind=function(){d.data._el.button_today.on("click",function(){d.data._datepicker.selectDate(new Date(d.data._today.getFullYear(),d.data._today.getMonth(),d.data._today.getDate()))})},d.select_date=function(t){d.data._datepicker.selectDate(t)},d.set_date=function(t){d.data.onSelectAllowed=!1,d.data._datepicker.selectDate(t),d.data.onSelectAllowed=!0},d.init_components=function(){a.find('[data-fc="button"]').button()},d.init=function(){d.prepare_data(),d.render(),d.render_datepicker(),d.init_components(),d.bind()},d.init()}return this})},destroy:function(){return this.each(function(){this.obj.destroy()})},select_date:function(t){return this.each(function(){this.obj.select_date(t)})},set_date:function(t){return this.each(function(){this.obj.set_date(t)})}};t.fn.calendar=function(a){return e[a]?e[a].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof a&&a?void t.error("Method "+a+" does not exist on $.calendar"):e.init.apply(this,arguments)}}(jQuery),$(function(){$('[data-fc="calendar"]').calendar()}),function(t){var e={init:function(e){return this.each(function(){var a=t(this);if(!a.data("_widget")){a.data("_widget",{type:"button",target:a});var n=this.obj={};n.defaults={disabled:!1,checked:!1,hidden:!1,width:"auto",popup_animation:!0},n.data=a.data(),n.options=t.extend(!0,{},n.defaults,n.data,e),a.data(n.options),n.data._handlers=null,n.data._el={popup:t('<div class="popup"></div>')},n.destroy=function(){n.data._el.popup.data("_widget")&&n.data._el.popup.popup("destroy"),a.removeData(),a.remove()},n.disable=function(){if(a.removeClass("button_hovered"),a.removeClass("button_clicked_out"),a.addClass("button_disabled"),t._data(a[0],"events")){n.data._handlers={};for(var e in t._data(a[0],"events"))n.data._handlers[e]=t._data(a[0],"events")[e].slice(0);a.off()}n.data.disabled=!0},n.enable=function(){if(a.removeClass("button_clicked_out"),a.removeClass("button_disabled"),n.data._handlers)for(var t in n.data._handlers)n.data._handlers[t].forEach(function(t){a.on(t.type+"."+t.namespace,t.handler)});n.data._handlers=null,n.data.disabled=!1},n.hide=function(){a.removeClass("button_clicked_out"),a.addClass("button_hidden"),n.data.hidden=!0},n.show=function(){a.removeClass("button_clicked_out"),a.removeClass("button_hidden"),n.data.hidden=!1},n.check=function(){a.addClass("button_checked"),a.attr("data-checked","true"),n.data.checked=!0},n.uncheck=function(){a.removeClass("button_checked"),a.attr("data-checked","false"),n.data.checked=!1},n.hover=function(){a.addClass("button_hovered")},n.unhover=function(){a.removeClass("button_hovered")},n.click=function(){a.addClass("button_clicked"),a.removeClass("button_clicked_out"),t("body").one("mouseup.button.private touchend.button.private",n.unclick)},n.unclick=function(){a.addClass("button_clicked_out"),a.removeClass("button_clicked")},n.set_width=function(t){a.css("width",t)},n.set_text=function(t){a.find(".button__text").text(t)},n.bind=function(){a.on("mouseover.button.private",n.hover),a.on("mouseout.button.private",n.unhover),a.on("mousedown.button.private touchstart.button.private",n.click),n.data.trigger&&a.on("click.button.trigger",function(t){t.preventDefault(),a.find("."+n.data.triggercontainer).trigger(n.data.trigger)})},n.bind_checkbox=function(){a.bindFirst("click.button.check",null,null,function(t){t.preventDefault(),n.data.checked?n.uncheck():n.check()})},n.bind_radio=function(){a.bindFirst("click.button.radio",null,null,function(t){t.preventDefault(),n.data.checked||n.check()})},n.init_components=function(){"popup"==n.data.toggle&&(n.data._el.popup=t(n.data.target),n.data._el.popup.popup({source:a,animation:n.data.popup_animation}))},n.init=function(){n.set_width(n.data.width),n.init_components(),n.bind(),a.hasClass("button_toggable_check")&&(n.data._widget.type="button.checkbox",n.init_check(),n.bind_checkbox()),a.hasClass("button_toggable_radio")&&(n.data._widget.type="button.radio",n.init_check(),n.bind_radio()),n.data.disabled?n.disable():n.enable(),n.data.hidden?n.hide():n.show(),n.set_width(n.data.width)},n.init_check=function(){n.data.checked?n.check():n.uncheck()},n.init()}return this})},destroy:function(){return this.each(function(){this.obj.destroy()})},disable:function(){return this.each(function(){this.obj.disable()})},enable:function(){return this.each(function(){this.obj.enable()})},unhover:function(){return this.each(function(){this.obj.unhover()})},hover:function(){return this.each(function(){this.obj.hover()})},hide:function(){return this.each(function(){this.obj.hide()})},show:function(){return this.each(function(){this.obj.show()})},set_width:function(t){return this.each(function(){this.obj.set_width(t)})},set_text:function(t){return this.each(function(){this.obj.set_text(t)})},check:function(){return this.each(function(){this.obj.check()})},uncheck:function(){return this.each(function(){this.obj.uncheck()})}};t.fn.button=function(a){return e[a]?e[a].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof a&&a?void t.error("Method "+a+" does not exist on $.button"):e.init.apply(this,arguments)}}(jQuery),$(function(){$('[data-fc="button"]').button()}),function(t){var e={init:function(e){return this.each(function(){var a=t(this);if(!a.data("_widget")){a.data("_widget",{type:"card",target:a});var n=this.obj={};n.defaults={hiddenLeft:!1,hiddenRight:!1},n.data=a.data(),n.options=t.extend(!0,{},n.defaults,n.data,e),a.data(n.options),n.data._el={button_toggle_left:a.closestChild('[data-toggle="left"]'),button_toggle_right:a.closestChild('[data-toggle="right"]'),card__main:a.closestChild(".card__main"),card__left:a.closestChild(".card__left"),card__right:a.closestChild(".card__right"),card__backdrop:a.closestChild(".card__backdrop")},n.destroy=function(){a.removeData()},n.hide_left=function(){n.data._el.button_toggle_left.find(".icon").toggleClass("icon_rotate_180deg"),n.data._el.card__left.addClass("card__left_hidden"),n.data._el.card__backdrop.remove(),t(window).trigger("resize")},n.hide_right=function(){n.data._el.button_toggle_right.find(".icon").toggleClass("icon_rotate_180deg"),n.data._el.card__right.addClass("card__right_hidden"),n.data._el.card__backdrop.remove(),t(window).trigger("resize")},n.show_left=function(){n.data._el.button_toggle_left.find(".icon").toggleClass("icon_rotate_180deg"),n.data._el.card__left.removeClass("card__left_hidden"),n.data._el.card__main.append(n.data._el.card__backdrop.one("click",function(){n.hide_left(),n.hide_right()})),t(window).trigger("resize")},n.show_right=function(){n.data._el.button_toggle_right.find(".icon").toggleClass("icon_rotate_180deg"),n.data._el.card__right.removeClass("card__right_hidden"),n.data._el.card__main.append(n.data._el.card__backdrop.one("click",function(){n.hide_left(),n.hide_right()})),t(window).trigger("resize")},n.toggle_left=function(){n.data._el.card__left.hasClass("card__left_hidden")?n.show_left():n.hide_left()},n.toggle_right=function(){n.data._el.card__right.hasClass("card__right_hidden")?n.show_right():n.hide_right()},n.bind=function(){n.data._el.button_toggle_left&&n.data._el.button_toggle_left.length>0&&n.data._el.button_toggle_left.on("click",function(){n.toggle_left()}),n.data._el.button_toggle_right&&n.data._el.button_toggle_right.length>0&&n.data._el.button_toggle_right.on("click",function(){n.toggle_right()})},n.init_components=function(){0==n.data._el.card__backdrop.length&&(n.data._el.card__backdrop=t('<div class="card__backdrop">')),n.data._el.button_toggle_left&&n.data._el.button_toggle_left.length>0&&(n.data._el.button_toggle_left.button(),n.data.hiddenLeft?n.hide_left():n.show_left(),setTimeout(function(){n.data._el.button_toggle_left.find(".icon").addClass("icon_animate")},500)),n.data._el.button_toggle_right&&n.data._el.button_toggle_right.length>0&&(n.data._el.button_toggle_right.button(),n.data.hiddenRight?n.hide_right():n.show_right(),setTimeout(function(){n.data._el.button_toggle_right.find(".icon").addClass("icon_animate")},500))},n.init=function(){n.init_components(),n.bind()},n.init()}return this})},destroy:function(){return this.each(function(){this.obj.destroy()})}};t.fn.card=function(a){return e[a]?e[a].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof a&&a?void t.error("Method "+a+" does not exist on $.card"):e.init.apply(this,arguments)}}(jQuery),$(function(){$('[data-fc="card"]').card()});