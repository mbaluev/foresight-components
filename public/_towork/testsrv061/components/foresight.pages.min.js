var Dashboard=function(t){var e=this._dashboard={};return e.const={CONTENT_LOADING:'<span class="spinner"></span>',CONTENT_NODATA:"Нет данных",CONTENT_ERROR:"Ошибка загрузки",BORDER_COLOR_BLUE:"#5a97f2",BORDER_COLOR_DEFAULT:"#ccc",BORDER_COLOR_PURPLE:"#8e6bf5",BORDER_COLOR_RED:"#ff5940",CONTENT_TYPE_TEXT:"text",CONTENT_TYPE_HTML:"html",CONTENT_TYPE_COUNT:"count"},e.data={single:!1,editable:!0,pagename:"",items:[],library:[],loader:null,grid:null,add:function(t){},save:function(t){}},e.data=$.extend(e.data,t),e.data._el={target:$("#"+e.data.containerid),tumbler:$(['<span class="header__column-item tumbler" id="tumbler_edit-page">','<span class="tumbler__box">','<div class="tumbler__sticker tumbler__sticker_position_left">','<div class="tumbler__sticker-label">Вкл</div>',"</div>",'<div class="tumbler__sticker tumbler__sticker_position_right">','<div class="tumbler__sticker-label">Выкл</div>',"</div>",'<button class="button" type="button" data-fc="button">','<span class="icon icon_svg_edit"></span>','<span class="button__anim"></span>',"</button>","</span>",'<input class="tumbler__input" type="checkbox" name="_tumbler" hidden/>',"</span>"].join("")).tumbler(),button_group:$('<span class="button-group header__column-item"></span>'),button_add:$(['<button class="button button_hidden" type="button" data-hidden="true" id="button_add-widget">','<span class="icon icon_svg_plus"></span>','<span class="button__text mobile mobile_hide">Добавить</span>','<span class="button__anim"></span>',"</button>"].join("")).button(),button_save:$(['<button class="button button_hidden" type="button" data-hidden="true" id="button_save-grid">','<span class="icon icon_svg_save"></span>','<span class="button__text mobile mobile_hide">Сохранить</span>','<span class="button__anim"></span>',"</button>"].join("")).button(),loader:$('<span class="spinner"></span>')},e.render_tumbler=function(){e.data._el.tumbler.on("on.fc.tumbler",function(){e.loader_add(),setTimeout(function(){e.data._el.button_add.button("show"),e.data._el.button_save.button("show"),e.data.grid.widget_grid("edit_mode"),e.data.single&&e.data.grid.widget_grid("disable"),e.loader_remove()},100)}).on("off.fc.tumbler",function(){e.loader_add(),setTimeout(function(){e.data._el.button_add.button("hide"),e.data._el.button_save.button("hide"),e.data.grid.widget_grid("view_mode"),e.loader_remove()},100)}),$(".header__column-right").prepend(e.data._el.tumbler)},e.render_buttons=function(){e.render_button_save(),e.render_button_add(),$(".header__column-right").prepend(e.data._el.button_group)},e.render_button_add=function(t){e.data._el.button_add.on("click",function(){var t={x:0,y:0,width:2,height:4,settings:{name:e.data.single?e.data.pagename:"Новый виджет",collapsed:!1}};e.data.grid.widget_grid("add_widget",t,function(t){"function"==typeof e.data.add&&e.data.add(t)}),e.data.single&&e.data._el.button_add.button("unhover").remove()}),e.data.single&&t&&e.data._el.button_add.button({hidden:!1}),e.data._el.button_group.prepend(e.data._el.button_add)},e.render_button_save=function(){e.data._el.button_save.on("click",function(){e.data.grid.widget_grid("save",function(t){"function"==typeof e.data.save&&e.data.save(t),e.data._el.tumbler.tumbler("uncheck")})}),e.data._el.button_group.append(e.data._el.button_save)},e.render_single=function(){e.data.single&&e.data.items.length>0&&(e.data.items.splice(1,e.data.items.length-1),e.data._el.button_add.remove())},e.render_grid=function(){e.data.grid=e.data._el.target.widget_grid({single:e.data.single,pagename:e.data.pagename,items:e.data.items,loader:e.data.loader,library:e.data.library,widget_buttons:[{id:"button_settings",icon:"icon_svg_settings",mode:"edit",click:function(t,a){e.settings(t,a)}},{id:"button_remove",icon:"icon_svg_trash",mode:"edit",click:function(t,a){e.data.grid.widget_grid("remove_widget",a.id),e.data.single&&e.render_button_add(!0)}}]})},e.settings=function(t,a){var d={buttons:[{name:"save",action:"save",icon:"icon_svg_ok"},{name:"destroy",action:"destroy",icon:"icon_svg_close"}],header:{caption:e.data.single?"Настройки страницы":"Настройки виджета",name:a.name},content:{tabs:[]},data:a};e.data.single?e.settings_render_source_tab(a,d.content.tabs,!0):(e.settings_render_general_tab(a,d.content.tabs,!0),e.settings_render_source_tab(a,d.content.tabs,!1)),$('<span class="modal__"></span>').appendTo("body").modal__(d).on("save.fc.modal",function(){var e=!1;$(this).find("[data-field]").each(function(){var d=$(this),n=d[d.data("fc").replace("-","_")]("value");"pagename"!=d.data("field")&&"elementname"!=d.data("field")||a[d.data("field")]==n||(e=!0),_.set(t.data(),d.data("field"),n)}),t.widget("set_name"),t.widget("set_color"),e&&t.widget("set_content"),$(this).modal__("destroy")})},e.settings_render_general_tab=function(t,a,d){a.push({id:"general",name:"Основные",active:d,content:$(['<div class="control"><div class="control__caption"><div class="control__text">Скрывать по умолчанию</div></div><div class="control__container"><label class="checkbox" data-fc="checkbox" data-field="collapsed"'+(t.collapsed?'data-checked="true"':"")+'><input class="checkbox__input" type="checkbox" name="collapsed"/><label class="checkbox__label"></label></label></div></div><div class="control"><div class="control__caption"><div class="control__text">Заголовок</div></div><div class="control__container"><span class="input input__has-clear" data-fc="input" data-field="name"><span class="input__box"><input type="text" class="input__control" value="'+t.name+'"><button class="button" type="button" data-fc="button"><span class="icon icon_svg_close"></span></button></span></span></div></div><div class="control"><div class="control__caption"><div class="control__text">Цвет</div></div><div class="control__container"><select class="select" name="color" data-fc="select" data-field="color"><option value="'+e.const.BORDER_COLOR_DEFAULT+'" '+(t.color==e.const.BORDER_COLOR_DEFAULT?"selected":"")+'>Серый</option><option value="'+e.const.BORDER_COLOR_BLUE+'" '+(t.color==e.const.BORDER_COLOR_BLUE?"selected":"")+'>Синий</option><option value="'+e.const.BORDER_COLOR_PURPLE+'" '+(t.color==e.const.BORDER_COLOR_PURPLE?"selected":"")+'>Фиолетовый</option><option value="'+e.const.BORDER_COLOR_RED+'" '+(t.color==e.const.BORDER_COLOR_RED?"selected":"")+">Красный</option></select></div></div>"].join(""))})},e.settings_render_source_tab=function(t,e,a){if(t.library){var d=$(['<div class="control">','<div class="control__caption">','<div class="control__text">Источник данных</div>',"</div>",'<div class="control__container">','<select class="select" name="pagename" data-fc="select" data-field="pagename" data-mode="radio-check" data-height="350"></select>',"</div>","</div>"].join("")),n=$(['<div class="control">','<div class="control__caption">','<div class="control__text">Виджет</div>',"</div>",'<div class="control__container">','<select class="select" name="elementname" data-fc="select" data-field="elementname" data-mode="radio-check" data-height="350"></select>',"</div>","</div>"].join(""));t.library.forEach(function(e){var a=$('<option value="'+e.value+'" '+(e.value==t.pagename?'selected="selected"':"")+">"+e.text+"</option>");e.value==t.pagename&&e.items.forEach(function(e){var a=$('<option value="'+e.value+'" '+(e.value==t.elementname?'selected="selected"':"")+">"+e.text+"</option>");n.find(".select").append(a)}),d.find(".select").append(a)}),d.find(".select").on("change",function(e){var a=[];$(this).data("_value").forEach(function(e){var d=t.library.filter(function(t){return t.value==e.value});d.length>0&&(d=d[0]).items&&a.push.apply(a,d.items)}),n.find(".select").select("update",a)}),e.push({id:"source",name:"Источник данных",active:a,content:$("<div></div>").append(d,n)})}},e.loader_add=function(){$(".fs-view__main").each(function(t,a){"innerHTML"in a&&t==$(".fs-view__main").length-1&&$(this).append(e.data._el.loader)})},e.loader_remove=function(){e.data._el.loader.remove()},e.init=function(){e.loader_add(),setTimeout(function(){e.data.editable&&(e.render_tumbler(),e.render_buttons()),e.render_single(),e.render_grid(),e.loader_remove()},100)},e.init(),e},Reports=function(t){var e=this._reports={};return e.data={items:[],filters:[],reports:[],loader:null,defaults:{itemWidth:2,itemHeight:5,x:0,y:0,favorite:!1,reportingCategoryId:0},search:{text:"",timer:null},grid:null},e.data=$.extend(!0,{},e.data,t),e.data._el={target:$("#"+e.data.containerid),tumbler:$(['<span class="header__column-item tumbler">','<span class="tumbler__box">','<div class="tumbler__sticker tumbler__sticker_position_left">','<div class="tumbler__sticker-label">Вкл</div>',"</div>",'<div class="tumbler__sticker tumbler__sticker_position_right">','<div class="tumbler__sticker-label">Выкл</div>',"</div>",'<button class="button" type="button" data-fc="button">','<span class="icon icon_svg_favorite_red"></span>',"</button>","</span>",'<input class="tumbler__input" type="checkbox" name="_tumbler" hidden/>',"</span>"].join("")),input:$(['<span class="header__column-item input input__has-clear" data-width="200">','<span class="input__box">','<span class="alertbox" data-fc="alertbox">','<span class="icon icon_svg_search"></span>',"</span>",'<input type="text" class="input__control">','<button class="button" type="button" data-fc="button">','<span class="icon icon_svg_close"></span>',"</button>","</span>","</span>"].join("")),radiogroup:$('<span class="header__column-item radio-group radio-group_type_buttons"></span>'),content:$(['<div class="fs-view">','<div class="fs-view__header">','<div class="header header_second">','<div class="header__column" id="filter"></div>','<div class="header__column" id="tumbler"></div>',"</div>","</div>",'<div class="fs-view__main">','<div class="fs-view__middle fs-view__middle_full">','<div class="fs-view__middle-scroll">','<div class="fs-view__middle-inner">','<div id="widget-grid" class="widget-grid grid-stack" data-gs-animate="true"></div>',"</div>","</div>","</div>","</div>","</div>"].join("")),loader:$('<span class="spinner"></span>')},e.render=function(){e.data._el.content.find("#filter").append(e.data._el.radiogroup),e.data._el.content.find("#tumbler").append(e.data._el.tumbler),e.data._el.target.append(e.data._el.content)},e.render_filters=function(){e.data._el.radiogroup.append($(['<label class="radio radio_type_button" data-fc="radio" data-checked="true">','<button class="button button_toggable_radio" type="button" data-fc="button" data-checked="true">','<span class="button__text">Все</span>',"</button>",'<input class="radio__input" type="radio" name="radio-group-button" value="0" hidden/>',"</label>"].join(""))),e.data.filters.forEach(function(t){e.data._el.radiogroup.append($(['<label class="radio radio_type_button" data-fc="radio" data-tooltip="'+t.reportingCategoryName+'">','<button class="button button_toggable_radio" type="button" data-fc="button">','<span class="button__text">'+t.reportingCategoryName+"</span>",'<span class="icon">','<span class="icon icon__circle" style="background-color: '+t.color+'"></span>',"</span>","</button>",'<input class="radio__input" type="radio" name="radio-group-button" value="'+t.reportingCategoryId+'" hidden/>',"</label>"].join("")))}),e.data._el.radiogroup.append(e.data._el.input)},e.render_grid=function(){var t={items:e.data.items,loader:e.data.loader};e.data.grid=$("#widget-grid").widget_grid(t)},e.render_reports=function(){e.data.reports.forEach(function(t,a){t.visible=!0,t.collapsed=!1,e.add_report(t),e.data.defaults.x+=e.data.defaults.itemWidth,e.data.defaults.x>=12&&(e.data.defaults.x=0,e.data.defaults.y+=e.data.defaults.itemHeight)}),e.data.grid.widget_grid("view_mode")},e.remove_reports=function(){e.data.items=[],e.data.defaults.x=0,e.data.defaults.y=0,e.data.grid.widget_grid("clear")},e.remove_report=function(t){t.visible=!1,t.collapsed=$("#"+t.reportingId).data().collapsed,e.data.grid.widget_grid("remove_widget",t.reportingId),e.data.items=e.data.items.filter(function(e){return e._id!=t.reportingId})},e.add_report=function(t){t.visible=!0;var a={x:e.data.defaults.x,y:e.data.defaults.y,width:e.data.defaults.itemWidth,height:e.data.defaults.itemHeight,settings:{id:t.reportingId,name:t.title,collapsed:t.collapsed,color:t.color,url:t.url,previewUrl:t.previewUrl,repFavoriteId:t.repFavoriteId,buttons:[{icon:t.repFavoriteId?"icon_svg_favorite_red":"icon_svg_favorite",tooltip:t.repFavoriteId?"Убрать из избранного":"Добавить в избранное",mode:"view",click:function(t,a){e.toggle_favorite(t,a)}}]}};e.data.items.push(a),e.data.grid.widget_grid("add_widget",a)},e.update_report=function(t){e.data.grid.widget_grid("update_widget",t.reportingId,e.data.defaults.x,e.data.defaults.y,e.data.defaults.itemWidth,e.data.defaults.itemHeight)},e.filter_reports=function(){e.loader_add(),setTimeout(function(){e.data.defaults.x=0,e.data.defaults.y=0,e.data.reports.forEach(function(t){(+t.reportingCategoryId==+e.data.defaults.reportingCategoryId||0==+e.data.defaults.reportingCategoryId)&&(e.data.defaults.favorite&&t.repFavoriteId||!e.data.defaults.favorite)&&t.title.toLowerCase().includes(e.data.search.text.toLowerCase())?(t.visible?e.update_report(t):e.add_report(t),e.data.defaults.x+=e.data.defaults.itemWidth,e.data.defaults.x>=12&&(e.data.defaults.x=0,e.data.defaults.y+=e.data.defaults.itemHeight)):t.visible&&e.remove_report(t)}),e.data.grid.widget_grid("view_mode"),e.loader_remove()},100)},e.toggle_favorite=function(t,a){var d=t.data()._el.buttons[0].find(".icon"),n=t.data()._el.buttons[0];d.attr("class",d.attr("class").replace(/\icon_svg_favorite.*?\b/g,"")),a.repFavoriteId?(d.addClass("icon_svg_favorite"),n.tooltip("update","Добавить в избранное"),t.data().repFavoriteId=null):(d.addClass("icon_svg_favorite_red"),n.tooltip("update","Убрать из избранного"),t.data().repFavoriteId=!0),n.tooltip("hide"),e.data.reports.filter(function(t){return t.reportingId==a.id})[0].repFavoriteId=t.data().repFavoriteId,e.filter_reports()},e.loader_add=function(){$(".fs-view__main").each(function(t,a){"innerHTML"in a&&t==$(".fs-view__main").length-1&&$(this).append(e.data._el.loader)})},e.loader_remove=function(){e.data._el.loader.remove()},e.bind=function(){e.data._el.radiogroup.find('[data-fc="radio"]').on("click",function(){e.data.defaults.reportingCategoryId=$(this).radio_group("value"),e.filter_reports()}),e.data._el.tumbler.on("on.fc.tumbler",function(){e.data.defaults.favorite=!0,e.filter_reports()}).on("off.fc.tumbler",function(){e.data.defaults.favorite=!1,e.filter_reports()}),e.data.defaults.favorite&&e.data._el.tumbler.tumbler("check"),e.data._el.input.on("keyup",function(){clearTimeout(e.data.search.timer),e.data.search.text=$(this).input("value"),e.data.search.timer=setTimeout(function(){e.filter_reports()},300)})},e.init_components=function(){e.data._el.radiogroup.radio_group(),e.data._el.input.input(),e.data._el.tumbler.tumbler(),e.data._el.content.find("#filter").css({"flex-wrap":"wrap"}),e.data._el.input.css({flex:"0 0 auto"})},e.init=function(){e.loader_add(),setTimeout(function(){e.render(),e.render_filters(),e.render_grid(),e.render_reports(),e.init_components(),e.bind(),e.loader_remove()},100)},e.init(),e},Settings=function(t){var e=this._settings={};return e.data={settings:[],loader:null,defaults:{itemWidth:2,itemHeight:7,x:0,y:0},grid:null,widgets:[],items:[],editable:!0},e.data=$.extend(!0,{},e.data,t),e.data._el={target:$("#"+e.data.containerid).addClass("widget-grid grid-stack").attr("data-gs-animate","true"),tumbler:$(['<span class="header__column-item tumbler" id="tumbler_edit-page">','<span class="tumbler__box">','<div class="tumbler__sticker tumbler__sticker_position_left">','<div class="tumbler__sticker-label">Вкл</div>',"</div>",'<div class="tumbler__sticker tumbler__sticker_position_right">','<div class="tumbler__sticker-label">Выкл</div>',"</div>",'<button class="button" type="button" data-fc="button">','<span class="icon icon_svg_edit"></span>','<span class="button__anim"></span>',"</button>","</span>",'<input class="tumbler__input" type="checkbox" name="_tumbler" hidden/>',"</span>"].join("")).tumbler(),button_group:$('<span class="button-group header__column-item"></span>'),button_save:$(['<button class="button button_hidden" type="button" data-hidden="true" id="button_save-grid">','<span class="icon icon_svg_save"></span>','<span class="button__text mobile mobile_hide">Сохранить</span>','<span class="button__anim"></span>',"</button>"].join("")).button(),loader:$('<span class="spinner"></span>')},e.process_settings=function(){if(e.data.settings.length>0){var t={},a=0,d=0;e.data.settings.map(function(n){n.category in t?(d=t[n.category],e.data.widgets[d].items.push({name:n.name,url:n.url,urltype:n.urltype})):(t[n.category]=a++,e.data.widgets.push({category:n.category,color:n.color,items:[{name:n.name,url:n.url,urltype:n.urltype}]}))}),e.data.widgets.map(function(t){var e="";t.items.map(function(t){e+='<tr><td><a class="link" href="'+t.url+'" target="'+t.urltype+'">'+t.name+"</a></td></tr>"}),t.html=['<div class="widget__content widget__content_scroll">','<table class="table">',"<tbody>"+e+"</tbody>","</table>","</div>"].join("")})}},e.render_tumbler=function(){e.data._el.tumbler.on("on.fc.tumbler",function(){e.loader_add(),setTimeout(function(){e.data._el.button_save.button("show"),e.data.grid.widget_grid("edit_mode"),e.loader_remove()},100)}).on("off.fc.tumbler",function(){e.loader_add(),setTimeout(function(){e.data._el.button_save.button("hide"),e.data.grid.widget_grid("view_mode"),e.loader_remove()},100)}),$(".header__column-right").prepend(e.data._el.tumbler)},e.render_buttons=function(){e.render_button_save(),$(".header__column-right").prepend(e.data._el.button_group)},e.render_button_save=function(){e.data._el.button_save.on("click",function(){e.data.grid.widget_grid("save",function(t){"function"==typeof e.data.save&&e.data.save(t),e.data._el.tumbler.tumbler("uncheck")})}),e.data._el.button_group.append(e.data._el.button_save)},e.render_grid=function(){var t={items:e.data.items,loader:e.data.loader};e.data.grid=e.data._el.target.widget_grid(t)},e.render_widgets=function(){e.data.widgets.forEach(function(t,a){e.add_widget(t),e.data.defaults.x+=e.data.defaults.itemWidth,e.data.defaults.x>=12&&(e.data.defaults.x=0,e.data.defaults.y+=e.data.defaults.itemHeight)}),e.data.grid.widget_grid("view_mode")},e.add_widget=function(t){var a={x:e.data.defaults.x,y:e.data.defaults.y,width:e.data.defaults.itemWidth,height:e.data.defaults.itemHeight,settings:{name:t.category,color:t.color,collapsed:!1,html:t.html}};e.data.items.push(a),e.data.grid.widget_grid("add_widget",a)},e.loader_add=function(){$(".fs-view__main").each(function(t,a){"innerHTML"in a&&t==$(".fs-view__main").length-1&&$(this).append(e.data._el.loader)})},e.loader_remove=function(){e.data._el.loader.remove()},e.init=function(){e.loader_add(),setTimeout(function(){e.process_settings(),e.data.editable&&(e.render_tumbler(),e.render_buttons()),e.render_grid(),e.render_widgets(),e.loader_remove()},100)},e.init(),e};